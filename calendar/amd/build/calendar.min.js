function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){if(c)a=c;var d=0,e=function(){};return{s:e,n:function n(){if(d>=a.length)return{done:!0};return{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f=!0,g=!1,h;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();f=a.done;return a},e:function e(a){g=!0;h=a},f:function f(){try{if(!f&&null!=c.return)c.return()}finally{if(g)throw h}}}}function _unsupportedIterableToArray(a,b){if(!a)return;if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(a,b)}function _arrayLikeToArray(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}define ("core_calendar/calendar",["jquery","core/ajax","core/str","core/templates","core/notification","core/custom_interaction_events","core/modal_events","core/modal_factory","core_calendar/modal_event_form","core_calendar/summary_modal","core_calendar/repository","core_calendar/events","core_calendar/view_manager","core_calendar/crud","core_calendar/selectors"],function(a,b,c,d,f,g,h,i,j,k,l,m,n,o,p){var q={ROOT:"[data-region='calendar']",DAY:"[data-region='day']",NEW_EVENT_BUTTON:"[data-action='new-event-button']",DAY_CONTENT:"[data-region='day-content']",LOADING_ICON:".loading-icon",VIEW_DAY_LINK:"[data-action='view-day-link']",CALENDAR_MONTH_WRAPPER:".calendarwrapper",TODAY:".today"},r="newEventTimestamp",s="newEventType",t=function(b,c,e,g){var h=null,i=g.attr("data-day-timestamp");if(e){h=e.attr("data-day-timestamp")}if(!e||h!=i){d.render("core/loading",{}).then(function(a,b){g.find(q.DAY_CONTENT).addClass("hidden");d.appendNodeContents(g,a,b);if(e){e.find(q.DAY_CONTENT).addClass("hidden");d.appendNodeContents(e,a,b)}}).then(function(){return l.updateEventStartDay(c,i)}).then(function(){a("body").trigger(m.eventMoved,[c,e,g])}).always(function(){var a=g.find(q.LOADING_ICON);g.find(q.DAY_CONTENT).removeClass("hidden");d.replaceNode(a,"","");if(e){var b=e.find(q.LOADING_ICON);e.find(q.DAY_CONTENT).removeClass("hidden");d.replaceNode(b,"","")}}).fail(f.exception)}},u=function(b,c){var d=a("body");d.on(m.created,function(){n.reloadCurrentMonth(b)});d.on(m.deleted,function(){n.reloadCurrentMonth(b)});d.on(m.updated,function(){n.reloadCurrentMonth(b)});d.on(m.editActionEvent,function(a,b){window.location.assign(b)});d.on(m.moveEvent,t);d.on(m.eventMoved,function(){n.reloadCurrentMonth(b)});o.registerEditListeners(b,c)},v=function(b){b.on("click",q.VIEW_DAY_LINK,function(c){var d=a(c.target),e=d.data("year"),g=d.data("month"),h=d.data("day"),i=d.data("courseid"),j=d.data("categoryid");n.refreshDayContent(b,e,g,h,i,j,b,"core_calendar/calendar_day").then(function(){c.preventDefault();var a="?view=day&time="+d.data("timestamp");return window.history.pushState({},"",a)}).fail(f.exception)});b.on("change",p.elements.courseSelector,function(){var c=a(this),d=c.val();n.reloadCurrentMonth(b,d,null).then(function(){return b.find(p.elements.courseSelector).val(d)}).fail(f.exception)});var c=o.registerEventFormModal(b),d=a(q.CALENDAR_MONTH_WRAPPER).data("context-id");u(b,c);if(d){var e=document.querySelectorAll("div.cell-plus-add-event"),g=document.querySelectorAll("div.c-d-add-event"),h=document.querySelector("div.add-event-add-button"),i=document.querySelector("div.event-types");if(e.length){L(e)}if(g.length){L(g)}if(i){i.addEventListener("click",M(i))}if(h){h.addEventListener("click",N)}b.on("click",q.DAY,function(a){if(a.target.closest("div.add-event")){return}var b=document.querySelector(q.CALENDAR_MONTH_WRAPPER),c=b.dataset;if(c.view&&"day"!==c.view){var d=a.target.closest("td"),e=d.dataset;sessionStorage.setItem(r,e.newEventTimestamp);l.getCalendarDayData(c.year,c.month,e.day,c.courseid,0).then(function(a){var b=a.events;if(b.length){var c=document.querySelector(".schedule"),d=c.querySelector("div.schedule-content"),e=c.querySelector("div.add-schedule-event");d.innerHTML="";var f=_createForOfIteratorHelper(b),g;try{for(f.s();!(g=f.n()).done;){var h=g.value,i="#fee7ae";if(h.groupid){(function(){var a=h.groupid;document.querySelectorAll(".legend-group").forEach(function(b){if(a===+b.dataset.groupId){i=b.querySelector(".legend-group-color").style.backgroundColor}})})()}var j=y(i),k=z(),l=A(),m=B(),n=C(i),o=D(i),p=E(),q=F(),r=1e3*h.timestart,s=1e3*(h.timestart+h.timeduration),t=G(r),u=G(s);p.append(t);q.append(u);o.append(p,q);l.append(h.popupname);k.append(l);if(h.description){m.append(h.description);k.append(m)}j.append(o,k);if(h.groupname){n.append(h.groupname);j.append(n)}d.append(j)}}catch(a){f.e(a)}finally{f.f()}c.style.display="block";document.addEventListener("click",H);e.addEventListener("click",J)}}).catch(function(a){console.error("GET day data",a);alert("GET day data ERROR. Please, report administrator")})}})}},w=function(a){var b=document.createElement("div");b.className=a||"";return b},x=function(a,b){var c=w(a);for(var d in b){c.style.setProperty(d,b[d])}return c},y=function(a){return x("schedule-line",{borderColor:a,background:"#EFFAFF"})},z=function(){return w("schedule-event-content")},A=function(){return w("schedule-event-name")},B=function(){return w("schedule-event-description")},C=function(a){return x("schedule-event-group",{background:a})},D=function(a){return x("event-time",{background:a})},E=function(){return w("event-time-start")},F=function(){return w("event-time-end")},G=function(a){var b=function(a){return 10>a?"0"+a:a},c=new Date(a),d=b(c.getHours()),e=b(c.getMinutes());return"".concat(d,":").concat(e)},H=function(a){if(!a.target.closest(".schedule")){document.querySelector(".schedule").style.display="none";document.removeEventListener("click",H)}},I=function(a){var b=document.querySelector("div.add-event"),c=a.target.closest("td");if(c){sessionStorage.setItem(r,c.dataset.newEventTimestamp)}b.style.display="block";b.querySelectorAll("input[type=datetime-local]").forEach(function(a){var b=1e3*+sessionStorage.getItem(r),c=new Date(b).toJSON(),d=c.split(":");a.value="".concat(d[0],":").concat(d[1])});setTimeout(function(){document.addEventListener("click",K)},0)},J=function(a){document.querySelector(".schedule").style.display="none";I(a)},K=function(a){if(!a.target.closest("div.add-event")){document.querySelector("div.add-event").style.display="none";document.removeEventListener("click",K)}},L=function(a){var b=_createForOfIteratorHelper(a),c;try{for(b.s();!(c=b.n()).done;){var d=c.value;d.addEventListener("click",I)}}catch(a){b.e(a)}finally{b.f()}},M=function(a){return function(b){var c=b.target.closest("div.event-type");if(c){a.querySelectorAll("div.event-type").forEach(function(a){a.classList.remove("active")});c.classList.add("active");sessionStorage.setItem(s,c.dataset.eventType)}}},N=function(){var a=document.querySelector("form.add-event-form");if(a){var b=new FormData(a),c=new Date(b.get("time-start")),d=new Date(b.get("time-end")),e=b.get("name"),f=b.get("description"),g=b.get("location"),h=sessionStorage.getItem(s),i={id:0,userid:0,modulename:"",instance:0,visible:1,_qf__core_calendar_local_event_forms_create:1,mform_showmore_id_general:1,name:e,"timestart[year]":c.getFullYear(),"timestart[month]":c.getMonth()+1,"timestart[day]":c.getDay()+16,"timestart[hour]":c.getHours(),"timestart[minute]":c.getMinutes(),eventtype:h,"description[text]":f||"","description[format]":1,location:g,duration:d-c?1:0,"timedurationuntil[year]":d.getFullYear(),"timedurationuntil[month]":d.getMonth()+1,"timedurationuntil[day]":d.getDay()+16,"timedurationuntil[hour]":d.getHours(),"timedurationuntil[minute]":d.getMinutes()},j="";for(var k in i){j+="".concat(k,"=").concat(i[k],"&")}j=encodeURI(j);l.submitCreateUpdateForm(j).then(function(){window.location.reload()}).catch(function(a){console.error(a)})}};return{init:function init(b){b=a(b);n.init(b);v(b)}}});
//# sourceMappingURL=calendar.min.js.map
