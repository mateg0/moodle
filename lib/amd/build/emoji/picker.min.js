define ("core/emoji/picker",["exports","core/localstorage","core/emoji/data","core/utils","core/str","core/templates"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=function(a){return a&&a.__esModule?a:{default:a}}(b);c=h(c);function g(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(g=function(a){return a?c:b})(a)}function h(a,b){if(!b&&a&&a.__esModule){return a}if(null===a||"object"!==j(a)&&"function"!=typeof a){return{default:a}}var c=g(b);if(c&&c.has(a)){return c.get(a)}var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a){if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var h=e?Object.getOwnPropertyDescriptor(a,f):null;if(h&&(h.get||h.set)){Object.defineProperty(d,f,h)}else{d[f]=a[f]}}}d.default=a;if(c){c.set(a,d)}return d}function j(a){"@babel/helpers - typeof";return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},j(a)}function k(a){return n(a)||m(a)||q(a)||l()}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function n(a){if(Array.isArray(a))return r(a)}function o(a,b){return t(a)||s(a,b)||q(a,b)||p()}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function q(a,b){if(!a)return;if("string"==typeof a)return r(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return r(a,b)}function r(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function s(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null==c)return;var d=[],e=!0,f=!1,g,h;try{for(c=c.call(a);!(e=(g=c.next()).done);e=!0){d.push(g.value);if(b&&d.length===b)break}}catch(a){f=!0;h=a}finally{try{if(!e&&null!=c["return"])c["return"]()}finally{if(f)throw h}}return d}function t(a){if(Array.isArray(a))return a}function u(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function v(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){u(f,d,e,g,h,"next",a)}function h(a){u(f,d,e,g,h,"throw",a)}g(void 0)})}}function w(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function x(a){for(var b=1,c;b<arguments.length;b++){c=null!=arguments[b]?arguments[b]:{};b%2?w(Object(c),!0).forEach(function(b){y(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):w(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function y(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}var z=5,A="moodle-recent-emojis",B=40,C=7,D={EMOJI:0,HEADER:1},E={CATEGORY_SELECTOR:"[data-action=\"show-category\"]",EMOJIS_CONTAINER:"[data-region=\"emojis-container\"]",EMOJI_PREVIEW:"[data-region=\"emoji-preview\"]",EMOJI_SHORT_NAME:"[data-region=\"emoji-short-name\"]",ROW_CONTAINER:"[data-region=\"row-container\"]",SEARCH_INPUT:"[data-region=\"search-input\"]",SEARCH_RESULTS_CONTAINER:"[data-region=\"search-results-container\"]"},F=function(a,b,c,d){var e=[];e.push({index:d+e.length,type:D.HEADER,data:{name:a,displayName:b}});for(var f=0,g;f<c.length;f+=C){g=c.slice(f,f+C);e.push({index:d+e.length,type:D.EMOJI,data:g})}return e},G=function(a){return a.map(function(a,b){return x(x({},a),{},{index:b})})},H=function(a){return a.reduce(function(a,b,c){if(b.type===D.HEADER){a[b.data.name]=c*B}return a},{})},I=function(){var a=v(regeneratorRuntime.mark(function c(a,b){var d,e,g;return regeneratorRuntime.wrap(function(c){while(1){switch(c.prev=c.next){case 0:d={index:a,text:b};c.next=3;return(0,f.render)("core/emoji/header_row",d);case 3:e=c.sent;g=document.createElement("div");g.innerHTML=e;return c.abrupt("return",g.firstChild);case 7:case"end":return c.stop();}}},c)}));return function(){return a.apply(this,arguments)}}(),J=function(){var a=v(regeneratorRuntime.mark(function c(a,b){var d,e,g;return regeneratorRuntime.wrap(function(c){while(1){switch(c.prev=c.next){case 0:d={index:a,emojis:b.map(function(a){var b=a.unified.split("-").map(function(a){return"0x".concat(a)}),c=String.fromCodePoint.apply(null,b);return{shortnames:":".concat(a.shortnames.join(": :"),":"),unified:a.unified,text:c,spacer:!1}}),spacers:Array(C-b.length).fill(!0)};c.next=3;return(0,f.render)("core/emoji/emoji_row",d);case 3:e=c.sent;g=document.createElement("div");g.innerHTML=e;return c.abrupt("return",g.firstChild);case 7:case"end":return c.stop();}}},c)}));return function(){return a.apply(this,arguments)}}(),K=function(a){return null!==a.getAttribute("data-short-names")},L=function(a){if(!a){return null}if("show-category"===a.getAttribute("data-action")){return a}else{return L(a.parentElement)}},M=function(a,b){return a.querySelector("[data-category=\"".concat(b,"\"]"))},N=function(a,b){for(var c=a.querySelectorAll(E.CATEGORY_SELECTOR),d=0,e;d<c.length;d++){e=c[d];e.classList.remove("selected")}b.classList.add("selected")},O=function(a,b,c){var d=[];if(0>b){b=0}for(var i in c){var j=c[i];d.push([j,i])}d.sort(function(c,d){var e=o(c,1),f=e[0],a=o(d,1),g=a[0];if(f<g){return-1}else if(f>g){return 1}else{return 0}});var e=d.reduce(function(a,c){var d=o(c,2),e=d[0],f=d[1];if(e<=b){a.categoryName=f;a.previousPosition=a.currentPosition;a.currentPosition=b}else if(null===a.nextPosition){a.nextPosition=e}return a},{categoryName:null,currentPosition:null,previousPosition:null,nextPosition:null}),f=e.categoryName,g=e.previousPosition,h=e.nextPosition;return[M(a,f),g,h]},P=function(){var a=b.default.get(A);return a?JSON.parse(a):[]},Q=function(a){b.default.set(A,JSON.stringify(a))},R=function(a,b,c){var d=a[0].data.name,e=a[0].data.displayName,f=P(),g=[c].concat(k(f.filter(function(a){return a.unified!=c.unified})));g=g.slice(0,3*C);var h=F(d,e,g);Q(g);return[G(h.concat(a.slice(b))),h.length]},S=function(a,b,c){var d=a>B?Math.floor(a/B):0,e=d>=z?d-z:d,f=c.slice(e,d+b+z);return f},T=function(){var a=v(regeneratorRuntime.mark(function b(a){var c;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:c=null;if(!(a.type===D.HEADER)){b.next=7;break}b.next=4;return I(a.index,a.data.displayName);case 4:c=b.sent;b.next=10;break;case 7:b.next=9;return J(a.index,a.data);case 9:c=b.sent;case 10:c.style.position="absolute";c.style.left=0;c.style.right=0;c.style.top="".concat(a.index*B,"px");return b.abrupt("return",c);case 15:case"end":return b.stop();}}},b)}));return function(){return a.apply(this,arguments)}}(),U=function(c,a){if(c.index!==a.index){return!1}if(c.type!==a.type){return!1}if(j(c.data)!=j(a.data)){return!1}if(c.type===D.HEADER){return c.data.name===a.data.name}else{if(c.data.length!==a.data.length){return!1}for(var b=0;b<c.data.length;b++){if(c.data[b].unified!=a.data[b].unified){return!1}}}return!0},V=function(){var a=v(regeneratorRuntime.mark(function d(a,b,c){var e,f,g,h,i;return regeneratorRuntime.wrap(function(d){while(1){switch(d.prev=d.next){case 0:e=c.filter(function(a){return!b.some(function(b){return U(b,a)})});f=b.filter(function(a){return c.some(function(b){return U(a,b)})});g=b.filter(function(a){return!c.some(function(b){return U(a,b)})});h=g.map(function(b){return a.querySelectorAll("[data-row=\"".concat(b.index,"\"]"))});d.next=6;return Promise.all(e.map(function(a){return T(a)}));case 6:i=d.sent;i.forEach(function(b,c){for(var d=e[c],g=null,h=0,j;h<f.length;h++){j=f[h];if(j.index>d.index){g=h;break}}if(null!==g){var k=f[g],l=a.querySelector("[data-row=\"".concat(k.index,"\"]"));a.insertBefore(b,l);f.splice(g,0,f)}else{f.push(d);a.appendChild(b)}});h.forEach(function(b){for(var c=0,d;c<b.length;c++){d=b[c];a.removeChild(d)}});case 9:case"end":return d.stop();}}},d)}));return function(){return a.apply(this,arguments)}}(),W=function(a){var b=[],c=[],d=0,e=!1,f=function(){var d=v(regeneratorRuntime.mark(function d(){var g;return regeneratorRuntime.wrap(function(d){while(1){switch(d.prev=d.next){case 0:if(c.length){d.next=2;break}return d.abrupt("return");case 2:if(!e){d.next=4;break}return d.abrupt("return");case 4:e=!0;g=c.slice();c=[];d.next=9;return V(a,b,g);case 9:b=g;e=!1;f();case 12:case"end":return d.stop();}}},d)}));return function(){return d.apply(this,arguments)}}();return function(b,e){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:10;c=S(b,g,e);f();if(d!==e.length){a.style.height="".concat(e.length*B,"px")}d=e.length}},X=function(a,b){b.classList.remove("hidden");a.classList.add("hidden")},Y=function(a,b,c){b.classList.add("hidden");a.classList.remove("hidden");c.value=""},Z=function(a,b){return function(c){var d=c.target;if(K(d)){b.textContent=d.getAttribute("data-short-names");a.textContent=d.textContent}}},$=function(a,b){return function(c){var d=c.target;if(K(d)){b.textContent="";a.textContent=""}}},_=function(a,b,c,d,e,f){return function(g,h,i){var j=g.target,k=h,l=i;Y(b,c,d);if(K(j)){var m=j.getAttribute("data-unified"),n=j.getAttribute("data-short-names").replace(/:/g,"").split(" "),p=b.scrollTop,q=null!==b.querySelector("[data-row=\"".concat(a-1,"\"]")),r=R(h,a,{unified:m,shortnames:n}),s=o(r,2);k=s[0];a=s[1];l=H(k);if(q){f(p,k)}e(j.textContent);return[k,l]}var t=L(j);if(t){var u=t.getAttribute("data-category"),v=i[u];b.scrollTop=v}return[k,l]}},aa=function(a,b,c,d,e){var f=O(a,c.scrollTop,d),g=o(f,3),h=g[0],i=g[1],j=g[2];return function(d,f){var g=c.scrollTop,k=b+B,l=b-B,m=g>=j||g<i;if(m){var n=O(a,g,d),p=o(n,3);h=p[0];i=p[1];j=p[2];N(a,h)}if(g<l||g>k){requestAnimationFrame(function(){e(g,f);b=g})}}},ba=function(a,b,d){var f=b.querySelector(E.ROW_CONTAINER),g=W(f);b.appendChild(f);return v(regeneratorRuntime.mark(function f(){var h,i,j,k;return regeneratorRuntime.wrap(function(f){while(1){switch(f.prev=f.next){case 0:h=a.value.toLowerCase();if(!h){f.next=11;break}X(d,b);i=Object.keys(c.byShortName).reduce(function(a,b){if(b.includes(h)){a.push({shortnames:[b],unified:c.byShortName[b]})}return a},[]);f.next=6;return(0,e.get_string)("searchresults","core");case 6:j=f.sent;k=F(j,j,i,0);g(0,k,k.length);f.next=12;break;case 11:Y(d,b,a);case 12:case"end":return f.stop();}}},f)}))},ca=function(a,b,c,e,f,g,h,i){var j=a.querySelector(E.SEARCH_INPUT),k=a.querySelector(E.SEARCH_RESULTS_CONTAINER),l=a.querySelector(E.EMOJI_PREVIEW),m=a.querySelector(E.EMOJI_SHORT_NAME),n=_(i,b,k,j,f,c),p=aa(a,e,b,g,c),q=ba(j,k,b);a.addEventListener("focus",Z(l,m),!0);a.addEventListener("blur",$(l,m),!0);a.addEventListener("mouseenter",Z(l,m),!0);a.addEventListener("mouseleave",$(l,m),!0);a.addEventListener("click",function(a){var b=n(a,h,g),c=o(b,2);h=c[0];g=c[1]});b.addEventListener("scroll",(0,d.throttle)(function(){return p(g,h)},50));j.addEventListener("input",(0,d.debounce)(q,200))},da=function(a,b){var d=a.querySelector(E.EMOJIS_CONTAINER),e=d.querySelector(E.ROW_CONTAINER),f=P(),g=[{name:"Recent",emojis:f}].concat(k(c.byCategory)),h=[],i=0;g.forEach(function(b){var c=M(a,b.name),d=c.title,e=F(b.name,d,b.emojis,h.length);if("Recent"===b.name){i=e.length}h=h.concat(e)});h=G(h);var j=H(h),l=W(e);l(0,h);ca(a,d,l,0,b,j,h,i)};a.default=da;return a.default});
//# sourceMappingURL=picker.min.js.map
