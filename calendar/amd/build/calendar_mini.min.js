define ("core_calendar/calendar_mini",["jquery","core_calendar/selectors","core_calendar/events","core_calendar/view_manager","core_calendar/repository"],function(a,b,c,d,e){var f=function(b){var d=a("body"),e="."+b.attr("id");d.on(c.created+e,b,g);d.on(c.deleted+e,b,g);d.on(c.updated+e,b,g);d.on(c.eventMoved+e,b,g)},g=function(b){var e=b.data,f=a("body"),g="."+e.attr("id");if(e.is(":visible")){d.reloadCurrentMonth(e).then(i)}else{f.off(c.created+g);f.off(c.deleted+g);f.off(c.updated+g);f.off(c.eventMoved+g)}},h=function(f){a("body").on(c.filterChanged,function(a,c){var d=f.find(b.eventType[c.type]);d.toggleClass("calendar_event_"+c.type,!c.hidden)});var g="."+f.attr("id");a("body").on("change"+g,b.elements.courseSelector,function(){if(f.is(":visible")){var b=a(this),c=b.val();d.reloadCurrentMonth(f,c,null)}else{a("body").off("change"+g)}})},i=function(){k();j()},j=function(){document.querySelector(".minicalendar-filter-by-course").querySelector(".filter-icon").addEventListener("click",l)},k=function(){document.querySelector("table.minicalendar").querySelectorAll("a.arrow-link").forEach(function(a){a.addEventListener("click",o)})},l=function(){var a=document.querySelector("section.minicalendar-filter-by-course").querySelector("div.minicalendar-filter-context"),b=a.querySelector("select.select-course");if("none"===a.style.display){var c=sessionStorage.getItem("filterCourseId");e.getUserCourses().then(function(d){m(b);d.forEach(function(a){var d=document.createElement("option");d.text=a.fullname;d.value=a.id;if(a.id===+c){d.selected=!0}b.append(d)});b.addEventListener("change",n);a.style.display="block"})}else{b.removeEventListener("change",n);a.style.display="none"}},m=function(a){var b=document.createElement("option");b.text="\u0412\u0441\u0435 \u043A\u0443\u0440\u0441\u044B";b.value="1";a.innerHTML="";a.append(b)},n=function(b){var c=b.target.value,e=document.querySelector("table.minicalendar").closest("div.calendarwrapper").parentElement;sessionStorage.setItem("filterCourseId",c);d.reloadCurrentMonth(a(e),c).then(i)},o=function(b){var c=document.querySelector("table.minicalendar").closest("div.calendarwrapper"),e=a(c.parentElement),f=c.dataset.courseid,g=c.dataset.categoryid,h=b.currentTarget;d.changeMonth(e,h.href,h.dataset.year,h.dataset.month,f,g,h.dataset.day).then(i);b.preventDefault()};return{init:function init(b,c){b=a(b);d.init(b);h(b);f(b);if(c){d.reloadCurrentMonth(b).then(i)}}}});
//# sourceMappingURL=calendar_mini.min.js.map
