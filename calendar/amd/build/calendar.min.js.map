{"version":3,"sources":["../src/calendar.js"],"names":["define","$","Ajax","Str","Templates","Notification","CustomEvents","ModalEvents","ModalFactory","ModalEventForm","SummaryModal","CalendarRepository","CalendarEvents","CalendarViewManager","CalendarCrud","CalendarSelectors","SELECTORS","ROOT","DAY","NEW_EVENT_BUTTON","DAY_CONTENT","LOADING_ICON","VIEW_DAY_LINK","CALENDAR_MONTH_WRAPPER","TODAY","CELL_ADD_EVENT_BUTTON_MONTH","CELL_ADD_EVENT_BUTTON_DAY","ADD_EVENT_FORM","ADD_EVENT_FORM_DATA","ADD_EVENT_FORM_ADD_BUTTON","ADD_EVENT_FORM_DELETE_BUTTON","EVENT_TYPES","EVENT_TYPE","SCHEDULE","SCHEDULE_CONTENT","SCHEDULE_ADD_EVENT_BUTTON","SCHEDULE_LINE","LEGEND_GROUP","LEGEND_GROUP_COLOR","SELECT_COURSE","SELECT_GROUP","SELECT_COURSE_WRAPPER","SELECT_GROUP_WRAPPER","BACK_BUTTON_FROM_SELECT","sessionStorageTimestampNewEventFieldName","sessionStorageEventTypeFieldName","sessionStorageEventIdFieldName","handleMoveEvent","e","eventId","originElement","destinationElement","originTimestamp","destinationTimestamp","attr","render","then","html","js","find","addClass","appendNodeContents","updateEventStartDay","trigger","eventMoved","always","destinationLoadingElement","removeClass","replaceNode","originLoadingElement","fail","exception","registerCalendarEventListeners","root","eventFormModalPromise","body","on","created","reloadCurrentMonth","deleted","updated","editActionEvent","url","window","location","assign","moveEvent","registerEditListeners","registerEventListeners","dayLink","target","year","data","month","day","courseId","categoryId","refreshDayContent","preventDefault","history","pushState","elements","courseSelector","selectElement","val","eventFormPromise","registerEventFormModal","contextId","addEventButtonsOnMonthCell","document","querySelectorAll","addEventButtonsOnDayCell","addEventButtonOnAddEventForm","querySelector","eventTypesOfAddEventForm","addEventForm","addEventFormBackToSelectType","addEventFormBackToSelectCourse","length","addEventListenerToAddEventButtonOnCells","addEventListener","getSelectorOfEventType","submitEvent","backToSelectType","backToSelectCourse","closest","calendarWrapper","calendarData","dataset","view","dayCell","dayCellData","sessionStorage","setItem","newEventTimestamp","getCalendarDayData","courseid","dayData","eventsOfDay","events","schedule","scheduleContent","scheduleAddEventButton","innerHTML","event","groupColor","console","log","groupid","groupId","forEach","group","style","backgroundColor","scheduleLine","getScheduleLine","scheduleEventContent","getScheduleEventContent","scheduleEventName","getScheduleEventName","scheduleEventDescription","getScheduleEventDescription","scheduleEventGroup","getScheduleEventGroup","eventTime","getEventTime","eventTimeStart","getEventTimeStart","eventTimeEnd","getEventTimeEnd","timestampStartEvent","timestart","timestampEndEvent","timeduration","timeStartEvent","getHoursAndMinutesByTimestamp","timeEndEvent","append","popupname","description","groupname","canedit","classList","add","showChangeEventForm","display","hideScheduleEvent","showAddEventFormFromDaySchedule","catch","error","alert","getDiv","className","newDiv","createElement","getDivWithStyles","styles","setProperty","borderColor","background","timestamp","fixDateIfUnderTen","time","dateByTimestamp","Date","dateHours","getHours","dateMinutes","getMinutes","removeEventListener","showAddEventForm","targetCell","clearEventForm","inputDate","addEventDateTimestamp","getItem","addEventDateJSON","toJSON","splitedAddEventDateJSON","split","value","setTimeout","hideAddEventForm","calendarEvent","changeEventForm","eventNameField","eventTypes","selectCourseWrapper","selectCourse","selectGroupWrapper","selectGroup","timeStartField","timeEndField","descriptionField","locationField","deleteEventButton","splitedTimeStartJSON","splitedTimeEndJSON","currentCourseOption","currentGroupOption","id","eventtype","name","eventType","course","currentCourse","text","fullname","selected","candelete","deleteEvent","hideChangeEventForm","eventForm","remove","clear","reload","addEventButtonsOnCells","addEventButtonOnCell","eventTypesDiv","clickEvent","eventTypeValue","eventTypeDiv","showSelectGroup","showSelectCourse","addEventFormData","FormData","timeStartDate","get","timeEndDate","nameOfEvent","descriptionOfEvent","locationOfEvent","formData","userid","modulename","instance","visible","mform_showmore_id_general","getFullYear","getMonth","getDate","formUrlencodedData","keyOfField","encodeURI","submitCreateUpdateForm","courseWrapper","getUserCourses","courses","formAddEvent","setDefaultSelect","appendOptionsToSelect","getCourseGroupsData","groups","select","emptyOption","options","option","selectOption","init"],"mappings":"sqCA2BAA,OAAM,0BAAC,CACK,QADL,CAEK,WAFL,CAGK,UAHL,CAIK,gBAJL,CAKK,mBALL,CAMK,gCANL,CAOK,mBAPL,CAQK,oBARL,CASK,gCATL,CAUK,6BAVL,CAWK,0BAXL,CAYK,sBAZL,CAaK,4BAbL,CAcK,oBAdL,CAeK,yBAfL,CAAD,CAiBE,SACIC,CADJ,CAEIC,CAFJ,CAGIC,CAHJ,CAIIC,CAJJ,CAKIC,CALJ,CAMIC,CANJ,CAOIC,CAPJ,CAQIC,CARJ,CASIC,CATJ,CAUIC,CAVJ,CAWIC,CAXJ,CAYIC,CAZJ,CAaIC,CAbJ,CAcIC,CAdJ,CAeIC,CAfJ,CAgBE,IAEFC,CAAAA,CAAS,CAAG,CACZC,IAAI,CAAE,0BADM,CAEZC,GAAG,CAAE,qBAFO,CAGZC,gBAAgB,CAAE,kCAHN,CAIZC,WAAW,CAAE,6BAJD,CAKZC,YAAY,CAAE,eALF,CAMZC,aAAa,CAAE,+BANH,CAOZC,sBAAsB,CAAE,kBAPZ,CAQZC,KAAK,CAAE,QARK,CASZC,2BAA2B,CAAE,yBATjB,CAUZC,yBAAyB,CAAE,mBAVf,CAWZC,cAAc,CAAE,YAXJ,CAYZC,mBAAmB,CAAE,qBAZT,CAaZC,yBAAyB,CAAE,0BAbf,CAcZC,4BAA4B,CAAE,6BAdlB,CAeZC,WAAW,CAAE,iBAfD,CAgBZC,UAAU,CAAE,gBAhBA,CAiBZC,QAAQ,CAAE,WAjBE,CAkBZC,gBAAgB,CAAE,sBAlBN,CAmBZC,yBAAyB,CAAE,wBAnBf,CAoBZC,aAAa,CAAE,mBApBH,CAqBZC,YAAY,CAAE,eArBF,CAsBZC,kBAAkB,CAAE,qBAtBR,CAuBZC,aAAa,CAAE,sBAvBH,CAwBZC,YAAY,CAAE,qBAxBF,CAyBZC,qBAAqB,CAAE,yBAzBX,CA0BZC,oBAAoB,CAAE,wBA1BV,CA2BZC,uBAAuB,CAAE,sBA3Bb,CAFV,CAgCAC,CAAwC,CAAG,mBAhC3C,CAiCAC,CAAgC,CAAG,WAjCnC,CAkCAC,CAA8B,CAAG,SAlCjC,CAgDFC,CAAe,CAAG,SAASC,CAAT,CAAYC,CAAZ,CAAqBC,CAArB,CAAoCC,CAApC,CAAwD,IACtEC,CAAAA,CAAe,CAAG,IADoD,CAEtEC,CAAoB,CAAGF,CAAkB,CAACG,IAAnB,CAAwB,oBAAxB,CAF+C,CAI1E,GAAIJ,CAAJ,CAAmB,CACfE,CAAe,CAAGF,CAAa,CAACI,IAAd,CAAmB,oBAAnB,CACrB,CAGD,GAAI,CAACJ,CAAD,EAAkBE,CAAe,EAAIC,CAAzC,CAA+D,CAC3DjD,CAAS,CAACmD,MAAV,CAAiB,cAAjB,CAAiC,EAAjC,EACKC,IADL,CACU,SAASC,CAAT,CAAeC,CAAf,CAAmB,CAErBP,CAAkB,CAACQ,IAAnB,CAAwB3C,CAAS,CAACI,WAAlC,EAA+CwC,QAA/C,CAAwD,QAAxD,EACAxD,CAAS,CAACyD,kBAAV,CAA6BV,CAA7B,CAAiDM,CAAjD,CAAuDC,CAAvD,EAEA,GAAIR,CAAJ,CAAmB,CACfA,CAAa,CAACS,IAAd,CAAmB3C,CAAS,CAACI,WAA7B,EAA0CwC,QAA1C,CAAmD,QAAnD,EACAxD,CAAS,CAACyD,kBAAV,CAA6BX,CAA7B,CAA4CO,CAA5C,CAAkDC,CAAlD,CACH,CAEJ,CAXL,EAYKF,IAZL,CAYU,UAAW,CAEb,MAAO7C,CAAAA,CAAkB,CAACmD,mBAAnB,CAAuCb,CAAvC,CAAgDI,CAAhD,CACV,CAfL,EAgBKG,IAhBL,CAgBU,UAAW,CAGbvD,CAAC,CAAC,MAAD,CAAD,CAAU8D,OAAV,CAAkBnD,CAAc,CAACoD,UAAjC,CAA6C,CAACf,CAAD,CAAUC,CAAV,CAAyBC,CAAzB,CAA7C,CAEH,CArBL,EAsBKc,MAtBL,CAsBY,UAAW,CAGf,GAAIC,CAAAA,CAAyB,CAAGf,CAAkB,CAACQ,IAAnB,CAAwB3C,CAAS,CAACK,YAAlC,CAAhC,CACA8B,CAAkB,CAACQ,IAAnB,CAAwB3C,CAAS,CAACI,WAAlC,EAA+C+C,WAA/C,CAA2D,QAA3D,EACA/D,CAAS,CAACgE,WAAV,CAAsBF,CAAtB,CAAiD,EAAjD,CAAqD,EAArD,EAEA,GAAIhB,CAAJ,CAAmB,CACf,GAAImB,CAAAA,CAAoB,CAAGnB,CAAa,CAACS,IAAd,CAAmB3C,CAAS,CAACK,YAA7B,CAA3B,CACA6B,CAAa,CAACS,IAAd,CAAmB3C,CAAS,CAACI,WAA7B,EAA0C+C,WAA1C,CAAsD,QAAtD,EACA/D,CAAS,CAACgE,WAAV,CAAsBC,CAAtB,CAA4C,EAA5C,CAAgD,EAAhD,CACH,CAEJ,CAnCL,EAoCKC,IApCL,CAoCUjE,CAAY,CAACkE,SApCvB,CAqCH,CACJ,CAhGK,CAyGFC,CAA8B,CAAG,SAASC,CAAT,CAAeC,CAAf,CAAsC,CACvE,GAAIC,CAAAA,CAAI,CAAG1E,CAAC,CAAC,MAAD,CAAZ,CAEA0E,CAAI,CAACC,EAAL,CAAQhE,CAAc,CAACiE,OAAvB,CAAgC,UAAW,CACvChE,CAAmB,CAACiE,kBAApB,CAAuCL,CAAvC,CACH,CAFD,EAGAE,CAAI,CAACC,EAAL,CAAQhE,CAAc,CAACmE,OAAvB,CAAgC,UAAW,CACvClE,CAAmB,CAACiE,kBAApB,CAAuCL,CAAvC,CACH,CAFD,EAGAE,CAAI,CAACC,EAAL,CAAQhE,CAAc,CAACoE,OAAvB,CAAgC,UAAW,CACvCnE,CAAmB,CAACiE,kBAApB,CAAuCL,CAAvC,CACH,CAFD,EAGAE,CAAI,CAACC,EAAL,CAAQhE,CAAc,CAACqE,eAAvB,CAAwC,SAASjC,CAAT,CAAYkC,CAAZ,CAAiB,CAErDC,MAAM,CAACC,QAAP,CAAgBC,MAAhB,CAAuBH,CAAvB,CACH,CAHD,EAKAP,CAAI,CAACC,EAAL,CAAQhE,CAAc,CAAC0E,SAAvB,CAAkCvC,CAAlC,EAEA4B,CAAI,CAACC,EAAL,CAAQhE,CAAc,CAACoD,UAAvB,CAAmC,UAAW,CAC1CnD,CAAmB,CAACiE,kBAApB,CAAuCL,CAAvC,CACH,CAFD,EAIA3D,CAAY,CAACyE,qBAAb,CAAmCd,CAAnC,CAAyCC,CAAzC,CACH,CAjIK,CAwIFc,CAAsB,CAAG,SAASf,CAAT,CAAe,CAExCA,CAAI,CAACG,EAAL,CAAQ,OAAR,CAAiB5D,CAAS,CAACM,aAA3B,CAA0C,SAAS0B,CAAT,CAAY,IAC9CyC,CAAAA,CAAO,CAAGxF,CAAC,CAAC+C,CAAC,CAAC0C,MAAH,CADmC,CAE9CC,CAAI,CAAGF,CAAO,CAACG,IAAR,CAAa,MAAb,CAFuC,CAG9CC,CAAK,CAAGJ,CAAO,CAACG,IAAR,CAAa,OAAb,CAHsC,CAI9CE,CAAG,CAAGL,CAAO,CAACG,IAAR,CAAa,KAAb,CAJwC,CAK9CG,CAAQ,CAAGN,CAAO,CAACG,IAAR,CAAa,UAAb,CALmC,CAM9CI,CAAU,CAAGP,CAAO,CAACG,IAAR,CAAa,YAAb,CANiC,CAOlD/E,CAAmB,CAACoF,iBAApB,CAAsCxB,CAAtC,CAA4CkB,CAA5C,CAAkDE,CAAlD,CAAyDC,CAAzD,CAA8DC,CAA9D,CAAwEC,CAAxE,CAAoFvB,CAApF,CACQ,4BADR,EACsCjB,IADtC,CAC2C,UAAW,CAClDR,CAAC,CAACkD,cAAF,GACA,GAAIhB,CAAAA,CAAG,CAAG,kBAAoBO,CAAO,CAACG,IAAR,CAAa,WAAb,CAA9B,CACA,MAAOT,CAAAA,MAAM,CAACgB,OAAP,CAAeC,SAAf,CAAyB,EAAzB,CAA6B,EAA7B,CAAiClB,CAAjC,CACV,CALD,EAKGZ,IALH,CAKQjE,CAAY,CAACkE,SALrB,CAMH,CAbD,EAeAE,CAAI,CAACG,EAAL,CAAQ,QAAR,CAAkB7D,CAAiB,CAACsF,QAAlB,CAA2BC,cAA7C,CAA6D,UAAW,IAChEC,CAAAA,CAAa,CAAGtG,CAAC,CAAC,IAAD,CAD+C,CAEhE8F,CAAQ,CAAGQ,CAAa,CAACC,GAAd,EAFqD,CAGpE3F,CAAmB,CAACiE,kBAApB,CAAuCL,CAAvC,CAA6CsB,CAA7C,CAAuD,IAAvD,EACKvC,IADL,CACU,UAAW,CAEb,MAAOiB,CAAAA,CAAI,CAACd,IAAL,CAAU5C,CAAiB,CAACsF,QAAlB,CAA2BC,cAArC,EAAqDE,GAArD,CAAyDT,CAAzD,CACV,CAJL,EAKKzB,IALL,CAKUjE,CAAY,CAACkE,SALvB,CAMH,CATD,EAWA,GAAIkC,CAAAA,CAAgB,CAAG3F,CAAY,CAAC4F,sBAAb,CAAoCjC,CAApC,CAAvB,CACIkC,CAAS,CAAG1G,CAAC,CAACe,CAAS,CAACO,sBAAX,CAAD,CAAoCqE,IAApC,CAAyC,YAAzC,CADhB,CAEApB,CAA8B,CAACC,CAAD,CAAOgC,CAAP,CAA9B,CAEA,GAAIE,CAAJ,CAAe,IACLC,CAAAA,CAA0B,CAAGC,QAAQ,CAACC,gBAAT,CAA0B9F,CAAS,CAACS,2BAApC,CADxB,CAELsF,CAAwB,CAAGF,QAAQ,CAACC,gBAAT,CAA0B9F,CAAS,CAACU,yBAApC,CAFtB,CAGLsF,CAA4B,CAAGH,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACa,yBAAjC,CAH1B,CAILqF,CAAwB,CAAGL,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACe,WAAjC,CAJtB,CAMLoF,CAAY,CAAGN,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACW,cAAjC,CANV,CAOLyF,CAA4B,CAAGD,CAAY,CAC5CF,aADgC,CAClBjG,CAAS,CAACyB,qBADQ,EAEhCwE,aAFgC,CAElBjG,CAAS,CAAC2B,uBAFQ,CAP1B,CAUL0E,CAA8B,CAAGF,CAAY,CAC9CF,aADkC,CACpBjG,CAAS,CAAC0B,oBADU,EAElCuE,aAFkC,CAEpBjG,CAAS,CAAC2B,uBAFU,CAV5B,CAcX,GAAIiE,CAA0B,CAACU,MAA/B,CAAuC,CACnCC,CAAuC,CAACX,CAAD,CAC1C,CAED,GAAIG,CAAwB,CAACO,MAA7B,CAAqC,CACjCC,CAAuC,CAACR,CAAD,CAC1C,CAED,GAAIG,CAAJ,CAA8B,CAC1BA,CAAwB,CAACM,gBAAzB,CACI,OADJ,CAEIC,CAAsB,CAACP,CAAD,CAF1B,CAIH,CAED,GAAIF,CAAJ,CAAkC,CAC9BA,CAA4B,CAACQ,gBAA7B,CAA8C,OAA9C,CAAuDE,CAAvD,CACH,CAED,GAAIN,CAAJ,CAAkC,CAC9BA,CAA4B,CAACI,gBAA7B,CAA8C,OAA9C,CAAuDG,CAAvD,CACH,CAED,GAAIN,CAAJ,CAAoC,CAChCA,CAA8B,CAACG,gBAA/B,CAAgD,OAAhD,CAAyDI,CAAzD,CACH,CAGDnD,CAAI,CAACG,EAAL,CAAQ,OAAR,CAAiB5D,CAAS,CAACE,GAA3B,CAAgC,SAAU8B,CAAV,CAAa,CAGzC,GAAIA,CAAC,CAAC0C,MAAF,CAASmC,OAAT,CAAiB7G,CAAS,CAACS,2BAA3B,CAAJ,CAA6D,CACzD,MACH,CALwC,GAOnCqG,CAAAA,CAAe,CAAGjB,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACO,sBAAjC,CAPiB,CAQnCwG,CAAY,CAAGD,CAAe,CAACE,OARI,CAUzC,GAAID,CAAY,CAACE,IAAb,EAA2C,KAAtB,GAAAF,CAAY,CAACE,IAAtC,CAAsD,IAC5CC,CAAAA,CAAO,CAAGlF,CAAC,CAAC0C,MAAF,CAASmC,OAAT,CAAiB,IAAjB,CADkC,CAE5CM,CAAW,CAAGD,CAAO,CAACF,OAFsB,CAIlDI,cAAc,CAACC,OAAf,CAAuBzF,CAAvB,CAAiEuF,CAAW,CAACG,iBAA7E,EAEA3H,CAAkB,CAAC4H,kBAAnB,CACIR,CAAY,CAACpC,IADjB,CAEIoC,CAAY,CAAClC,KAFjB,CAGIsC,CAAW,CAACrC,GAHhB,CAIIiC,CAAY,CAACS,QAJjB,CAKI,CALJ,EAOKhF,IAPL,CAOU,SAAAiF,CAAO,CAAI,CACb,GAAMC,CAAAA,CAAW,CAAGD,CAAO,CAACE,MAA5B,CAEA,GAAID,CAAW,CAACpB,MAAhB,CAAwB,IACdsB,CAAAA,CAAQ,CAAG/B,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACiB,QAAjC,CADG,CAEd4G,CAAe,CAAGD,CAAQ,CAAC3B,aAAT,CAAuBjG,CAAS,CAACkB,gBAAjC,CAFJ,CAGd4G,CAAsB,CAAGF,CAAQ,CAAC3B,aAAT,CAC3BjG,CAAS,CAACmB,yBADiB,CAHX,CAOpB0G,CAAe,CAACE,SAAhB,CAA4B,EAA5B,CAPoB,iCASFL,CATE,QASpB,2BAA+B,IAAtBM,CAAAA,CAAsB,SACvBC,CAAU,CAAG,SADU,CAG3BC,OAAO,CAACC,GAAR,CAAY,OAAZ,CAAqBH,CAArB,EAEA,GAAIA,CAAK,CAACI,OAAV,CAAmB,aACf,GAAMC,CAAAA,CAAO,CAAGL,CAAK,CAACI,OAAtB,CAEAvC,QAAQ,CAACC,gBAAT,CAA0B9F,CAAS,CAACqB,YAApC,EAAkDiH,OAAlD,CAA0D,SAAAC,CAAK,CAAI,CAC/D,GAAIF,CAAO,GAAK,CAACE,CAAK,CAACvB,OAAN,CAAcqB,OAA/B,CAAwC,CACpCJ,CAAU,CAAGM,CAAK,CAACtC,aAAN,CAAoBjG,CAAS,CAACsB,kBAA9B,EAAkDkH,KAAlD,CAAwDC,eACxE,CACJ,CAJD,CAHe,IAQlB,CAb0B,GAerBC,CAAAA,CAAY,CAAGC,CAAe,CAACV,CAAD,CAfT,CAgBrBW,CAAoB,CAAGC,CAAuB,EAhBzB,CAiBrBC,CAAiB,CAAGC,CAAoB,EAjBnB,CAkBrBC,CAAwB,CAAGC,CAA2B,EAlBjC,CAmBrBC,CAAkB,CAAGC,CAAqB,CAAClB,CAAD,CAnBrB,CAqBrBmB,CAAS,CAAGC,CAAY,CAACpB,CAAD,CArBH,CAsBrBqB,CAAc,CAAGC,CAAiB,EAtBb,CAuBrBC,CAAY,CAAGC,CAAe,EAvBT,CA0BrBC,CAAmB,CAAqB,GAAlB,CAAA1B,CAAK,CAAC2B,SA1BP,CA2BrBC,CAAiB,CAA8C,GAA3C,EAAE5B,CAAK,CAAC2B,SAAN,CAAkB3B,CAAK,CAAC6B,YAA1B,CA3BC,CA6BrBC,CAAc,CAAGC,CAA6B,CAACL,CAAD,CA7BzB,CA8BrBM,CAAY,CAAGD,CAA6B,CAACH,CAAD,CA9BvB,CAgC3BN,CAAc,CAACW,MAAf,CAAsBH,CAAtB,EACAN,CAAY,CAACS,MAAb,CAAoBD,CAApB,EAEAZ,CAAS,CAACa,MAAV,CAAiBX,CAAjB,CAAiCE,CAAjC,EAEAV,CAAiB,CAACmB,MAAlB,CAAyBjC,CAAK,CAACkC,SAA/B,EAEAtB,CAAoB,CAACqB,MAArB,CAA4BnB,CAA5B,EAEA,GAAId,CAAK,CAACmC,WAAV,CAAuB,CACnBnB,CAAwB,CAACiB,MAAzB,CAAgCjC,CAAK,CAACmC,WAAtC,EACAvB,CAAoB,CAACqB,MAArB,CAA4BjB,CAA5B,CACH,CAEDN,CAAY,CAACuB,MAAb,CAAoBb,CAApB,CAA+BR,CAA/B,EAEA,GAAIZ,CAAK,CAACoC,SAAV,CAAqB,CACjBlB,CAAkB,CAACe,MAAnB,CAA0BjC,CAAK,CAACoC,SAAhC,EAEA1B,CAAY,CAACuB,MAAb,CAAoBf,CAApB,CACH,CAED,GAAIlB,CAAK,CAACqC,OAAV,CAAmB,CACf3B,CAAY,CAAC4B,SAAb,CAAuBC,GAAvB,CAA2B,UAA3B,EAEA7B,CAAY,CAAClC,gBAAb,CAA8B,OAA9B,CAAuCgE,CAAmB,CAACxC,CAAD,CAA1D,CACH,CAEDH,CAAe,CAACoC,MAAhB,CAAuBvB,CAAvB,CACH,CAtEmB,+BAwEpBd,CAAQ,CAACY,KAAT,CAAeiC,OAAf,CAAyB,OAAzB,CAEA5E,QAAQ,CAACW,gBAAT,CAA0B,OAA1B,CAAmCkE,CAAnC,EACA5C,CAAsB,CAACtB,gBAAvB,CAAwC,OAAxC,CAAiDmE,CAAjD,CACH,CACJ,CAvFL,EAwFKC,KAxFL,CAwFW,SAAAC,CAAK,CAAI,CACZ3C,OAAO,CAAC2C,KAAR,CAAc,cAAd,CAA8BA,CAA9B,EAEAC,KAAK,CAAC,kDAAD,CACR,CA5FL,CA6FH,CAsBJ,CAnID,CAoIH,CACJ,CAvVK,CAyVAC,CAAM,CAAG,SAACC,CAAD,CAAe,CAC1B,GAAMC,CAAAA,CAAM,CAAGpF,QAAQ,CAACqF,aAAT,CAAuB,KAAvB,CAAf,CAEAD,CAAM,CAACD,SAAP,CAAmBA,CAAS,EAAI,EAAhC,CAEA,MAAOC,CAAAA,CACV,CA/VK,CAiWAE,CAAgB,CAAG,SAACH,CAAD,CAAYI,CAAZ,CAAuB,CAC5C,GAAMH,CAAAA,CAAM,CAAGF,CAAM,CAACC,CAAD,CAArB,CAEA,IAAK,GAAIxC,CAAAA,CAAT,GAAkB4C,CAAAA,CAAlB,CAA0B,CACtBH,CAAM,CAACzC,KAAP,CAAa6C,WAAb,CAAyB7C,CAAzB,CAAgC4C,CAAM,CAAC5C,CAAD,CAAtC,CACH,CAED,MAAOyC,CAAAA,CACV,CAzWK,CA2WAtC,CAAe,CAAG,SAACV,CAAD,CAAgB,CACpC,MAAOkD,CAAAA,CAAgB,CAAC,eAAD,CAAkB,CACrCG,WAAW,CAAErD,CADwB,CAErCsD,UAAU,CAAE,SAFyB,CAAlB,CAI1B,CAhXK,CAkXA1C,CAAuB,CAAG,UAAM,CAClC,MAAOkC,CAAAA,CAAM,CAAC,wBAAD,CAChB,CApXK,CAsXAhC,CAAoB,CAAG,UAAM,CAC/B,MAAOgC,CAAAA,CAAM,CAAC,qBAAD,CAChB,CAxXK,CA0XA9B,CAA2B,CAAG,UAAM,CACtC,MAAO8B,CAAAA,CAAM,CAAC,4BAAD,CAChB,CA5XK,CA8XA5B,CAAqB,CAAG,SAAClB,CAAD,CAAgB,CAC1C,MAAOkD,CAAAA,CAAgB,CAAC,sBAAD,CAAyB,CAC5CI,UAAU,CAAEtD,CADgC,CAAzB,CAG1B,CAlYK,CAoYAoB,CAAY,CAAG,SAACpB,CAAD,CAAgB,CACjC,MAAOkD,CAAAA,CAAgB,CAAC,YAAD,CAAe,CAClCI,UAAU,CAAEtD,CADsB,CAAf,CAG1B,CAxYK,CA0YAsB,CAAiB,CAAG,UAAM,CAC5B,MAAOwB,CAAAA,CAAM,CAAC,kBAAD,CAChB,CA5YK,CA8YAtB,CAAe,CAAG,UAAM,CAC1B,MAAOsB,CAAAA,CAAM,CAAC,gBAAD,CAChB,CAhZK,CAkZAhB,CAA6B,CAAG,SAACyB,CAAD,CAAe,IAC3CC,CAAAA,CAAiB,CAAG,SAACC,CAAD,CAAU,CAChC,MAAc,GAAP,CAAAA,CAAI,CAAQ,IAAMA,CAAd,CAAqBA,CACnC,CAHgD,CAK3CC,CAAe,CAAG,GAAIC,CAAAA,IAAJ,CAASJ,CAAT,CALyB,CAO7CK,CAAS,CAAGJ,CAAiB,CAACE,CAAe,CAACG,QAAhB,EAAD,CAPgB,CAQ7CC,CAAW,CAAGN,CAAiB,CAACE,CAAe,CAACK,UAAhB,EAAD,CARc,CAUjD,gBAAUH,CAAV,aAAuBE,CAAvB,CACH,CA7ZK,CA+ZArB,CAAiB,CAAG,SAAC1C,CAAD,CAAW,CACjC,GAAI,CAACA,CAAK,CAACtD,MAAN,CAAamC,OAAb,CAAqB7G,CAAS,CAACiB,QAA/B,CAAL,CAA+C,CAC3C4E,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACiB,QAAjC,EAA2CuH,KAA3C,CAAiDiC,OAAjD,CAA2D,MAA3D,CACA5E,QAAQ,CAACoG,mBAAT,CAA6B,OAA7B,CAAsCvB,CAAtC,CACH,CACJ,CApaK,CAsaAwB,CAAgB,CAAG,SAAClE,CAAD,CAAW,IAC1B7B,CAAAA,CAAY,CAAGN,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACW,cAAjC,CADW,CAE1BwL,CAAU,CAAGnE,CAAK,CAACtD,MAAN,CAAamC,OAAb,CAAqB,IAArB,CAFa,CAIhC,GAAIsF,CAAJ,CAAgB,CACZ/E,cAAc,CAACC,OAAf,CAAuBzF,CAAvB,CAAiEuK,CAAU,CAACnF,OAAX,CAAmBM,iBAApF,CACH,CAED8E,CAAc,CAACjG,CAAD,CAAd,CAEAA,CAAY,CAACqC,KAAb,CAAmBiC,OAAnB,CAA6B,OAA7B,CAEAtE,CAAY,CAACL,gBAAb,CAA8B,4BAA9B,EAA4DwC,OAA5D,CAAoE,SAAA+D,CAAS,CAAI,IACvEC,CAAAA,CAAqB,CAAuE,GAApE,EAAClF,cAAc,CAACmF,OAAf,CAAuB3K,CAAvB,CAD8C,CAEvE4K,CAAgB,CAAG,GAAIZ,CAAAA,IAAJ,CAASU,CAAT,EAAgCG,MAAhC,EAFoD,CAGvEC,CAAuB,CAAGF,CAAgB,CAACG,KAAjB,CAAuB,GAAvB,CAH6C,CAK7EN,CAAS,CAACO,KAAV,WAAqBF,CAAuB,CAAC,CAAD,CAA5C,aAAmDA,CAAuB,CAAC,CAAD,CAA1E,CACH,CAND,EAQAG,UAAU,CAAC,UAAM,CACbhH,QAAQ,CAACW,gBAAT,CAA0B,OAA1B,CAAmCsG,CAAnC,CACH,CAFS,CAEP,CAFO,CAGb,CA7bK,CA+bAnC,CAA+B,CAAG,SAAC3C,CAAD,CAAW,CAC/CnC,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACiB,QAAjC,EAA2CuH,KAA3C,CAAiDiC,OAAjD,CAA2D,MAA3D,CAEAyB,CAAgB,CAAClE,CAAD,CACnB,CAncK,CAqcAwC,CAAmB,CAAG,SAACuC,CAAD,CAAmB,CAC3C,MAAO,WAAW,IACRC,CAAAA,CAAe,CAAGnH,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACW,cAAjC,CADV,CAERsM,CAAc,CAAGD,CAAe,CAAC/G,aAAhB,CAA8B,kBAA9B,CAFT,CAGRiH,CAAU,CAAGF,CAAe,CAAC/G,aAAhB,CAA8BjG,CAAS,CAACe,WAAxC,CAHL,CAIRoM,CAAmB,CAAGH,CAAe,CAAC/G,aAAhB,CAA8BjG,CAAS,CAACyB,qBAAxC,CAJd,CAKR2L,CAAY,CAAGD,CAAmB,CAAClH,aAApB,CAAkCjG,CAAS,CAACuB,aAA5C,CALP,CAMR8L,CAAkB,CAAGL,CAAe,CAAC/G,aAAhB,CAA8BjG,CAAS,CAAC0B,oBAAxC,CANb,CAOR4L,CAAW,CAAGD,CAAkB,CAACpH,aAAnB,CAAiCjG,CAAS,CAACwB,YAA3C,CAPN,CAQR+L,CAAc,CAAGP,CAAe,CAAC/G,aAAhB,CAA8B,wBAA9B,CART,CASRuH,CAAY,CAAGR,CAAe,CAAC/G,aAAhB,CAA8B,sBAA9B,CATP,CAURwH,CAAgB,CAAGT,CAAe,CAAC/G,aAAhB,CAA8B,4BAA9B,CAVX,CAWRyH,CAAa,CAAGV,CAAe,CAAC/G,aAAhB,CAA8B,sBAA9B,CAXR,CAaR0H,CAAiB,CAAGX,CAAe,CAAC/G,aAAhB,CAA8BjG,CAAS,CAACc,4BAAxC,CAbZ,CAeR8M,CAAoB,CAAG,GAAIhC,CAAAA,IAAJ,CAAmC,GAA1B,CAAAmB,CAAa,CAACpD,SAAvB,EAAyC8C,MAAzC,GAAkDE,KAAlD,CAAwD,GAAxD,CAff,CAgBRkB,CAAkB,CAAG,GAAIjC,CAAAA,IAAJ,CAAoE,GAA3D,EAAC,CAACmB,CAAa,CAACpD,SAAf,CAA2B,EAACoD,CAAa,CAAClD,YAA3C,CAAT,EACtB4C,MADsB,GAEtBE,KAFsB,CAEhB,GAFgB,CAhBb,CAoBRmB,CAAmB,CAAGjI,QAAQ,CAACqF,aAAT,CAAuB,QAAvB,CApBd,CAqBR6C,CAAkB,CAAGlI,QAAQ,CAACqF,aAAT,CAAuB,QAAvB,CArBb,CAuBdkB,CAAc,CAACY,CAAD,CAAd,CAEA5F,cAAc,CAACC,OAAf,CAAuBvF,CAAvB,CAAuDiL,CAAa,CAACiB,EAArE,EACA5G,cAAc,CAACC,OAAf,CAAuBxF,CAAvB,CAAyDkL,CAAa,CAACkB,SAAvE,EAEAhB,CAAc,CAACL,KAAf,CAAuBG,CAAa,CAACmB,IAArC,CACAX,CAAc,CAACX,KAAf,WAA0BgB,CAAoB,CAAC,CAAD,CAA9C,aAAqDA,CAAoB,CAAC,CAAD,CAAzE,EACAJ,CAAY,CAACZ,KAAb,WAAwBiB,CAAkB,CAAC,CAAD,CAA1C,aAAiDA,CAAkB,CAAC,CAAD,CAAnE,EAEA,GAAId,CAAa,CAAC5C,WAAlB,CAA+B,CAC3BsD,CAAgB,CAACb,KAAjB,CAAyBG,CAAa,CAAC5C,WAC1C,CAED,GAAI4C,CAAa,CAAC3I,QAAlB,CAA4B,CACxBsJ,CAAa,CAACd,KAAd,CAAsBG,CAAa,CAAC3I,QACvC,CAED8I,CAAU,CAACpH,gBAAX,CAA4B9F,CAAS,CAACgB,UAAtC,EAAkDsH,OAAlD,CAA0D,SAAA6F,CAAS,CAAI,CACnE,GAAIA,CAAS,CAACnH,OAAV,CAAkBmH,SAAlB,GAAgCpB,CAAa,CAACkB,SAAlD,CAA6D,CACzDE,CAAS,CAAC7D,SAAV,CAAoBC,GAApB,CAAwB,QAAxB,CACH,CACJ,CAJD,EAMA,GAAIwC,CAAa,CAACqB,MAAlB,CAA0B,CACtB,GAAMC,CAAAA,CAAa,CAAGtB,CAAa,CAACqB,MAApC,CAEAN,CAAmB,CAACE,EAApB,CAAyBK,CAAa,CAACL,EAAvC,CACAF,CAAmB,CAACQ,IAApB,CAA2BD,CAAa,CAACE,QAAzC,CACAT,CAAmB,CAACU,QAApB,IAEApB,CAAY,CAACnD,MAAb,CAAoB6D,CAApB,CACH,CAED,GAAIf,CAAa,CAAC3E,OAAlB,CAA2B,CACvB2F,CAAkB,CAACC,EAAnB,CAAwBjB,CAAa,CAAC3E,OAAtC,CACA2F,CAAkB,CAACO,IAAnB,CAA0BvB,CAAa,CAAC3C,SAAxC,CACA2D,CAAkB,CAACS,QAAnB,IAEAlB,CAAW,CAACrD,MAAZ,CAAmB8D,CAAnB,CACH,CAED,GAAIhB,CAAa,CAAC0B,SAAlB,CAA6B,CACzBd,CAAiB,CAACnF,KAAlB,CAAwBiC,OAAxB,CAAkC,OACrC,CAEDuC,CAAe,CAACxE,KAAhB,CAAsBiC,OAAtB,CAAgC,OAAhC,CAEAoC,UAAU,CAAC,UAAM,CACbc,CAAiB,CAACnH,gBAAlB,CAAmC,OAAnC,CAA4CkI,CAA5C,EACA7I,QAAQ,CAACW,gBAAT,CAA0B,OAA1B,CAAmCmI,CAAnC,CACH,CAHS,CAGP,CAHO,CAIb,CACJ,CAjhBK,CAmhBAvC,CAAc,CAAG,SAACwC,CAAD,CAAe,IAC5B3B,CAAAA,CAAc,CAAG2B,CAAS,CAAC3I,aAAV,CAAwB,kBAAxB,CADW,CAE5BiH,CAAU,CAAG0B,CAAS,CAAC3I,aAAV,CAAwBjG,CAAS,CAACe,WAAlC,CAFe,CAG5BoM,CAAmB,CAAGyB,CAAS,CAAC3I,aAAV,CAAwBjG,CAAS,CAACyB,qBAAlC,CAHM,CAI5B2L,CAAY,CAAGD,CAAmB,CAAClH,aAApB,CAAkCjG,CAAS,CAACuB,aAA5C,CAJa,CAK5B8L,CAAkB,CAAGuB,CAAS,CAAC3I,aAAV,CAAwBjG,CAAS,CAAC0B,oBAAlC,CALO,CAM5B4L,CAAW,CAAGD,CAAkB,CAACpH,aAAnB,CAAiCjG,CAAS,CAACwB,YAA3C,CANc,CAO5BiM,CAAgB,CAAGmB,CAAS,CAAC3I,aAAV,CAAwB,4BAAxB,CAPS,CAQ5ByH,CAAa,CAAGkB,CAAS,CAAC3I,aAAV,CAAwB,sBAAxB,CARY,CAUlCgH,CAAc,CAACL,KAAf,CAAuB,EAAvB,CACAa,CAAgB,CAACb,KAAjB,CAAyB,EAAzB,CACAc,CAAa,CAACd,KAAd,CAAsB,EAAtB,CACAQ,CAAY,CAACrF,SAAb,CAAyB,EAAzB,CACAuF,CAAW,CAACvF,SAAZ,CAAwB,EAAxB,CAEAmF,CAAU,CAACpH,gBAAX,CAA4B9F,CAAS,CAACgB,UAAtC,EAAkDsH,OAAlD,CAA0D,SAAA6F,CAAS,CAAI,CACnEA,CAAS,CAAC7D,SAAV,CAAoBuE,MAApB,CAA2B,QAA3B,CACH,CAFD,EAIAxB,CAAkB,CAAC7E,KAAnB,CAAyBiC,OAAzB,CAAmC,MAAnC,CACA0C,CAAmB,CAAC3E,KAApB,CAA0BiC,OAA1B,CAAoC,MAApC,CACAyC,CAAU,CAAC1E,KAAX,CAAiBiC,OAAjB,CAA2B,MAC9B,CA1iBK,CA4iBAkE,CAAmB,CAAG,SAAC3G,CAAD,CAAW,CACnC,GAAI,CAACA,CAAK,CAACtD,MAAN,CAAamC,OAAb,CAAqB7G,CAAS,CAACW,cAA/B,CAAL,CAAqD,CACjDyG,cAAc,CAAC0H,KAAf,EACH,CAEDhC,CAAgB,CAAC9E,CAAD,CACnB,CAljBK,CAojBA8E,CAAgB,CAAG,SAAC9E,CAAD,CAAW,CAChC,GAAI,CAACA,CAAK,CAACtD,MAAN,CAAamC,OAAb,CAAqB7G,CAAS,CAACW,cAA/B,CAAL,CAAqD,CACjDkF,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACW,cAAjC,EAAiD6H,KAAjD,CAAuDiC,OAAvD,CAAiE,MAAjE,CACA5E,QAAQ,CAACoG,mBAAT,CAA6B,OAA7B,CAAsCa,CAAtC,EACAjH,QAAQ,CAACoG,mBAAT,CAA6B,OAA7B,CAAsC0C,CAAtC,CACH,CACJ,CA1jBK,CA4jBAD,CAAW,CAAG,UAAM,CACtB,GAAMzM,CAAAA,CAAO,CAAGmF,cAAc,CAACmF,OAAf,CAAuBzK,CAAvB,CAAhB,CAEAnC,CAAkB,CAAC+O,WAAnB,CAA+BzM,CAA/B,EACKO,IADL,CACU,UAAgB,CAClB2B,MAAM,CAACC,QAAP,CAAgB2K,MAAhB,EACH,CAHL,EAIKnE,KAJL,CAIW1C,OAAO,CAAC2C,KAJnB,CAKH,CApkBK,CAskBAtE,CAAuC,CAAG,SAACyI,CAAD,CAA4B,kCACvCA,CADuC,QACxE,2BAAyD,IAAhDC,CAAAA,CAAgD,SACrDA,CAAoB,CAACzI,gBAArB,CAAsC,OAAtC,CAA+C0F,CAA/C,CACH,CAHuE,+BAI3E,CA1kBK,CA4kBAzF,CAAsB,CAAG,SAACyI,CAAD,CAAmB,CAC9C,MAAO,UAACC,CAAD,CAAgB,CACnB,GAAMhB,CAAAA,CAAS,CAAGgB,CAAU,CAACzK,MAAX,CAAkBmC,OAAlB,CAA0B7G,CAAS,CAACgB,UAApC,CAAlB,CAEA,GAAImN,CAAJ,CAAe,CACX,GAAMiB,CAAAA,CAAc,CAAGjB,CAAS,CAACnH,OAAV,CAAkBmH,SAAzC,CAEAe,CAAa,CAACpJ,gBAAd,CAA+B9F,CAAS,CAACgB,UAAzC,EAAqDsH,OAArD,CAA6D,SAAA+G,CAAY,CAAI,CACzEA,CAAY,CAAC/E,SAAb,CAAuBuE,MAAvB,CAA8B,QAA9B,CACH,CAFD,EAIAV,CAAS,CAAC7D,SAAV,CAAoBC,GAApB,CAAwB,QAAxB,EACAnD,cAAc,CAACC,OAAf,CAAuBxF,CAAvB,CAAyDuN,CAAzD,EAEA,OAAQA,CAAR,EACI,IAAK,OAAL,CAAc,CACVvJ,QAAQ,CACHI,aADL,CACmBjG,CAAS,CAACW,cAD7B,EAEKsF,aAFL,CAEmBjG,CAAS,CAACyB,qBAF7B,EAGKwE,aAHL,CAGmBjG,CAAS,CAACuB,aAH7B,EAIKiF,gBAJL,CAIsB,QAJtB,CAIgC8I,CAJhC,CAKH,CACD,IAAK,QAAL,CAAe,CACXC,CAAgB,EACnB,CAVL,CAYH,CACJ,CACJ,CAxmBK,CA0mBA7I,CAAW,CAAG,UAAM,CACtB,GAAMP,CAAAA,CAAY,CAAGN,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACY,mBAAjC,CAArB,CAEA,GAAIuF,CAAJ,CAAkB,IACRqJ,CAAAA,CAAgB,CAAG,GAAIC,CAAAA,QAAJ,CAAatJ,CAAb,CADX,CAERuJ,CAAa,CAAG,GAAI9D,CAAAA,IAAJ,CAAS4D,CAAgB,CAACG,GAAjB,CAAqB,YAArB,CAAT,CAFR,CAGRC,CAAW,CAAG,GAAIhE,CAAAA,IAAJ,CAAS4D,CAAgB,CAACG,GAAjB,CAAqB,UAArB,CAAT,CAHN,CAIRE,CAAW,CAAGL,CAAgB,CAACG,GAAjB,CAAqB,MAArB,CAJN,CAKRG,CAAkB,CAAGN,CAAgB,CAACG,GAAjB,CAAqB,aAArB,CALb,CAMRI,CAAe,CAAGP,CAAgB,CAACG,GAAjB,CAAqB,UAArB,CANV,CAQRxB,CAAS,CAAG/G,cAAc,CAACmF,OAAf,CAAuB1K,CAAvB,CARJ,CASRI,CAAO,CAAGmF,cAAc,CAACmF,OAAf,CAAuBzK,CAAvB,CATF,CAWdoG,OAAO,CAACC,GAAR,CAAY,cAAZ,CAA4BgG,CAA5B,EAEA,GAAI,CAACA,CAAL,CAAgB,CACZrD,KAAK,CAAC,2BAAD,CAAL,CACA,MACH,CAED,GAAI,CAAC+E,CAAL,CAAkB,CACd/E,KAAK,CAAC,yBAAD,CAAL,CACA,MACH,CAED,GAAMkF,CAAAA,CAAQ,CAAG,CACbhC,EAAE,CAAE/L,CAAO,EAAI,CADF,CAEbgO,MAAM,CAAE,CAFK,CAGbC,UAAU,CAAE,EAHC,CAIbC,QAAQ,CAAE,CAJG,CAKbC,OAAO,CAAE,CALI,CAMbC,yBAAyB,CAAE,CANd,CAObnC,IAAI,CAAE2B,CAPO,CAQb,kBAAmBH,CAAa,CAACY,WAAd,EARN,CASb,mBAAoBZ,CAAa,CAACa,QAAd,GAA2B,CATlC,CAUb,iBAAkBb,CAAa,CAACc,OAAd,EAVL,CAWb,kBAAmBd,CAAa,CAAC5D,QAAd,EAXN,CAYb,oBAAqB4D,CAAa,CAAC1D,UAAd,EAZR,CAabiC,SAAS,CAAEE,CAbE,CAcb,oBAAqB2B,CAAkB,EAAI,EAd9B,CAeb,sBAAuB,CAfV,CAgBb1L,QAAQ,CAAE2L,CAhBG,CAAjB,CAmBA,GAAI9N,CAAJ,CAAa,CACT+N,CAAQ,4CAAR,CAA0D,CAC7D,CAFD,IAEO,CACHA,CAAQ,4CAAR,CAA0D,CAC7D,CAED,GAAIJ,CAAW,CAAGF,CAAlB,CAAiC,CAC7BM,CAAQ,SAAR,CAAuB,CAAvB,CACAA,CAAQ,CAAC,yBAAD,CAAR,CAAsCJ,CAAW,CAACU,WAAZ,EAAtC,CACAN,CAAQ,CAAC,0BAAD,CAAR,CAAuCJ,CAAW,CAACW,QAAZ,GAAyB,CAAhE,CACAP,CAAQ,CAAC,wBAAD,CAAR,CAAqCJ,CAAW,CAACY,OAAZ,EAArC,CACAR,CAAQ,CAAC,yBAAD,CAAR,CAAsCJ,CAAW,CAAC9D,QAAZ,EAAtC,CACAkE,CAAQ,CAAC,2BAAD,CAAR,CAAwCJ,CAAW,CAAC5D,UAAZ,EAC3C,CAPD,IAOO,CACHgE,CAAQ,SAAR,CAAuB,CAC1B,CAED,OAAQ7B,CAAR,EACI,IAAK,OAAL,CAAc,IACJpJ,CAAAA,CAAQ,CAAGyK,CAAgB,CAACG,GAAjB,CAAqB,UAArB,CADP,CAEJtH,CAAO,CAAGmH,CAAgB,CAACG,GAAjB,CAAqB,SAArB,CAFN,CAIV,GAAI,CAAC5K,CAAD,EAA0B,IAAb,GAAAA,CAAjB,CAAoC,CAChC+F,KAAK,CAAC,sBAAD,CAAL,CACA,MACH,CAED,GAAI,CAACzC,CAAD,EAAwB,IAAZ,GAAAA,CAAhB,CAAkC,CAC9ByC,KAAK,CAAC,uBAAD,CAAL,CACA,MACH,CAEDkF,CAAQ,cAAR,CAA4BjL,CAA5B,CACAiL,CAAQ,QAAR,CAAsB3H,CAAtB,CAEA,KACH,CAED,IAAK,QAAL,CAAe,CACX,GAAMtD,CAAAA,CAAQ,CAAGyK,CAAgB,CAACG,GAAjB,CAAqB,UAArB,CAAjB,CAEA,GAAI,CAAC5K,CAAD,EAA0B,IAAb,GAAAA,CAAjB,CAAoC,CAChC+F,KAAK,CAAC,sBAAD,CAAL,CACA,MACH,CAEDkF,CAAQ,SAAR,CAAuBjL,CAAvB,CAEA,KACH,CAhCL,CAmCA,GAAI0L,CAAAA,CAAkB,CAAG,EAAzB,CAEA,IAAK,GAAMC,CAAAA,CAAX,GAAyBV,CAAAA,CAAzB,CAAmC,CAC/BS,CAAkB,YAAOC,CAAP,aAAqBV,CAAQ,CAACU,CAAD,CAA7B,KACrB,CAEDD,CAAkB,CAAGE,SAAS,CAACF,CAAD,CAA9B,CAEArJ,cAAc,CAAC0H,KAAf,GAEAnP,CAAkB,CAACiR,sBAAnB,CAA0CH,CAA1C,EACKjO,IADL,CACU,UAAmB,CACrB2B,MAAM,CAACC,QAAP,CAAgB2K,MAAhB,EACH,CAHL,EAIKnE,KAJL,CAIW,SAAAC,CAAK,CAAI,CACZ3C,OAAO,CAAC2C,KAAR,CAAcA,CAAd,CACH,CANL,CAOH,CACJ,CA7tBK,CA+tBAlE,CAAgB,CAAG,SAACqB,CAAD,CAAW,CAChC,GAAM6I,CAAAA,CAAa,CAAG7I,CAAK,CAACtD,MAAN,CAAamC,OAAb,CAAqB7G,CAAS,CAACyB,qBAA/B,CAAtB,CAEAoP,CAAa,CACR5K,aADL,CACmBjG,CAAS,CAACuB,aAD7B,EAEK0K,mBAFL,CAEyB,QAFzB,CAEmCqD,CAFnC,EAIAuB,CAAa,CAACrI,KAAd,CAAoBiC,OAApB,CAA8B,MAA9B,CACA5E,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACe,WAAjC,EAA8CyH,KAA9C,CAAoDiC,OAApD,CAA8D,MACjE,CAxuBK,CA0uBA7D,CAAkB,CAAG,SAACoB,CAAD,CAAW,CAClC,GAAM6I,CAAAA,CAAa,CAAGhL,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACyB,qBAAjC,CAAtB,CAEAoP,CAAa,CACR5K,aADL,CACmBjG,CAAS,CAACuB,aAD7B,EAEKiF,gBAFL,CAEsB,QAFtB,CAEgC8I,CAFhC,EAIAtH,CAAK,CAACtD,MAAN,CAAamC,OAAb,CAAqB7G,CAAS,CAAC0B,oBAA/B,EAAqD8G,KAArD,CAA2DiC,OAA3D,CAAqE,MAArE,CACAoG,CAAa,CAACrI,KAAd,CAAoBiC,OAApB,CAA8B,MACjC,CAnvBK,CAqvBA8E,CAAgB,CAAG,UAAM,CAC3B5P,CAAkB,CAACmR,cAAnB,GACKtO,IADL,CACU,SAAAuO,CAAO,CAAI,IACPC,CAAAA,CAAY,CAAGnL,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACW,cAAjC,CADR,CAEPwM,CAAmB,CAAG6D,CAAY,CAAC/K,aAAb,CAA2BjG,CAAS,CAACyB,qBAArC,CAFf,CAGP2L,CAAY,CAAGD,CAAmB,CAAClH,aAApB,CAAkCjG,CAAS,CAACuB,aAA5C,CAHR,CAIP2N,CAAa,CAAG8B,CAAY,CAAC/K,aAAb,CAA2BjG,CAAS,CAACe,WAArC,CAJT,CAMbkQ,CAAgB,CAAC7D,CAAD,CAAhB,CAEA,GAAI2D,CAAO,CAACzK,MAAZ,CAAoB,CAChB4K,CAAqB,CAAC9D,CAAD,CAAe2D,CAAf,CACxB,CAED7B,CAAa,CAAC1G,KAAd,CAAoBiC,OAApB,CAA8B,MAA9B,CACA0C,CAAmB,CAAC3E,KAApB,CAA0BiC,OAA1B,CAAoC,MACvC,CAfL,EAgBKG,KAhBL,CAgBW1C,OAAO,CAAC2C,KAhBnB,CAiBH,CAvwBK,CAywBAyE,CAAe,CAAG,SAACtH,CAAD,CAAW,CAC/B,GAAMjD,CAAAA,CAAQ,CAAGiD,CAAK,CAACtD,MAAN,CAAakI,KAA9B,CAEAjN,CAAkB,CAACwR,mBAAnB,CAAuCpM,CAAvC,EACKvC,IADL,CACU,SAAA4O,CAAM,CAAI,IACNJ,CAAAA,CAAY,CAAGnL,QAAQ,CAACI,aAAT,CAAuBjG,CAAS,CAACW,cAAjC,CADT,CAENwM,CAAmB,CAAG6D,CAAY,CAAC/K,aAAb,CAA2BjG,CAAS,CAACyB,qBAArC,CAFhB,CAGN4L,CAAkB,CAAG2D,CAAY,CAAC/K,aAAb,CAA2BjG,CAAS,CAAC0B,oBAArC,CAHf,CAIN0L,CAAY,CAAGD,CAAmB,CAAClH,aAApB,CAAkCjG,CAAS,CAACuB,aAA5C,CAJT,CAKN+L,CAAW,CAAGD,CAAkB,CAACpH,aAAnB,CAAiCjG,CAAS,CAACwB,YAA3C,CALR,CAOZyP,CAAgB,CAAC3D,CAAD,CAAhB,CAEAF,CAAY,CAACnB,mBAAb,CAAiC,QAAjC,CAA2CqD,CAA3C,EAEA,GAAI8B,CAAM,CAAC9K,MAAX,CAAmB,CACf4K,CAAqB,CAAC5D,CAAD,CAAc8D,CAAd,CACxB,CAEDjE,CAAmB,CAAC3E,KAApB,CAA0BiC,OAA1B,CAAoC,MAApC,CACA4C,CAAkB,CAAC7E,KAAnB,CAAyBiC,OAAzB,CAAmC,MACtC,CAlBL,EAmBKG,KAnBL,CAmBW1C,OAAO,CAAC2C,KAnBnB,CAoBH,CAhyBK,CAkyBAoG,CAAgB,CAAG,SAACI,CAAD,CAAY,CACjC,GAAMC,CAAAA,CAAW,CAAGzL,QAAQ,CAACqF,aAAT,CAAuB,QAAvB,CAApB,CACAoG,CAAW,CAAC1E,KAAZ,CAAoB,IAApB,CACA0E,CAAW,CAAChD,IAAZ,CAAmB,KAAnB,CAEA+C,CAAM,CAACtJ,SAAP,CAAmB,EAAnB,CACAsJ,CAAM,CAACpH,MAAP,CAAcqH,CAAd,CACH,CAzyBK,CA2yBAJ,CAAqB,CAAG,SAACG,CAAD,CAASE,CAAT,CAAqB,kCAC1BA,CAD0B,QAC/C,2BAA8B,IAAnBC,CAAAA,CAAmB,SACpBC,CAAY,CAAG5L,QAAQ,CAACqF,aAAT,CAAuB,QAAvB,CADK,CAE1BuG,CAAY,CAAC7E,KAAb,CAAqB4E,CAAM,CAACxD,EAA5B,CACAyD,CAAY,CAACnD,IAAb,CAAoBkD,CAAM,CAACtD,IAAP,EAAesD,CAAM,CAACjD,QAA1C,CAEA8C,CAAM,CAACpH,MAAP,CAAcwH,CAAd,CACH,CAP8C,+BAQlD,CAnzBK,CAqzBN,MAAO,CACHC,IAAI,CAAE,cAASjO,CAAT,CAAe,CACjBA,CAAI,CAAGxE,CAAC,CAACwE,CAAD,CAAR,CAEA5D,CAAmB,CAAC6R,IAApB,CAAyBjO,CAAzB,EACAe,CAAsB,CAACf,CAAD,CACzB,CANE,CAQV,CA91BK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is the highest level module for the calendar. It is\n * responsible for initialising all of the components required for\n * the calendar to run. It also coordinates the interaction between\n * components by listening for and responding to different events\n * triggered within the calendar UI.\n *\n * @module     core_calendar/calendar\n * @package    core_calendar\n * @copyright  2017 Simey Lameze <simey@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n            'jquery',\n            'core/ajax',\n            'core/str',\n            'core/templates',\n            'core/notification',\n            'core/custom_interaction_events',\n            'core/modal_events',\n            'core/modal_factory',\n            'core_calendar/modal_event_form',\n            'core_calendar/summary_modal',\n            'core_calendar/repository',\n            'core_calendar/events',\n            'core_calendar/view_manager',\n            'core_calendar/crud',\n            'core_calendar/selectors',\n        ],\n        function(\n            $,\n            Ajax,\n            Str,\n            Templates,\n            Notification,\n            CustomEvents,\n            ModalEvents,\n            ModalFactory,\n            ModalEventForm,\n            SummaryModal,\n            CalendarRepository,\n            CalendarEvents,\n            CalendarViewManager,\n            CalendarCrud,\n            CalendarSelectors\n        ) {\n\n    var SELECTORS = {\n        ROOT: \"[data-region='calendar']\",\n        DAY: \"[data-region='day']\",\n        NEW_EVENT_BUTTON: \"[data-action='new-event-button']\",\n        DAY_CONTENT: \"[data-region='day-content']\",\n        LOADING_ICON: '.loading-icon',\n        VIEW_DAY_LINK: \"[data-action='view-day-link']\",\n        CALENDAR_MONTH_WRAPPER: \".calendarwrapper\",\n        TODAY: '.today',\n        CELL_ADD_EVENT_BUTTON_MONTH: 'div.cell-plus-add-event',\n        CELL_ADD_EVENT_BUTTON_DAY: 'div.c-d-add-event',\n        ADD_EVENT_FORM: '.add-event',\n        ADD_EVENT_FORM_DATA: 'form.add-event-form',\n        ADD_EVENT_FORM_ADD_BUTTON: 'div.add-event-add-button',\n        ADD_EVENT_FORM_DELETE_BUTTON: 'div.add-event-delete-button',\n        EVENT_TYPES: 'div.event-types',\n        EVENT_TYPE: 'div.event-type',\n        SCHEDULE: '.schedule',\n        SCHEDULE_CONTENT: 'div.schedule-content',\n        SCHEDULE_ADD_EVENT_BUTTON: 'div.add-schedule-event',\n        SCHEDULE_LINE: 'div.schedule-line',\n        LEGEND_GROUP: '.legend-group',\n        LEGEND_GROUP_COLOR: '.legend-group-color',\n        SELECT_COURSE: 'select.select-course',\n        SELECT_GROUP: 'select.select-group',\n        SELECT_COURSE_WRAPPER: 'div.event-select-course',\n        SELECT_GROUP_WRAPPER: 'div.event-select-group',\n        BACK_BUTTON_FROM_SELECT: 'div.event-back-image',\n    };\n\n    const sessionStorageTimestampNewEventFieldName = 'newEventTimestamp';\n    const sessionStorageEventTypeFieldName = 'eventType';\n    const sessionStorageEventIdFieldName = 'eventId';\n\n    /**\n     * Handler for the drag and drop move event. Provides a loading indicator\n     * while the request is sent to the server to update the event start date.\n     *\n     * Triggers a eventMoved calendar javascript event if the event was successfully\n     * updated.\n     *\n     * @param {event} e The calendar move event\n     * @param {int} eventId The event id being moved\n     * @param {object|null} originElement The jQuery element for where the event is moving from\n     * @param {object} destinationElement The jQuery element for where the event is moving to\n     */\n    var handleMoveEvent = function(e, eventId, originElement, destinationElement) {\n        var originTimestamp = null;\n        var destinationTimestamp = destinationElement.attr('data-day-timestamp');\n\n        if (originElement) {\n            originTimestamp = originElement.attr('data-day-timestamp');\n        }\n\n        // If the event has actually changed day.\n        if (!originElement || originTimestamp != destinationTimestamp) {\n            Templates.render('core/loading', {})\n                .then(function(html, js) {\n                    // First we show some loading icons in each of the days being affected.\n                    destinationElement.find(SELECTORS.DAY_CONTENT).addClass('hidden');\n                    Templates.appendNodeContents(destinationElement, html, js);\n\n                    if (originElement) {\n                        originElement.find(SELECTORS.DAY_CONTENT).addClass('hidden');\n                        Templates.appendNodeContents(originElement, html, js);\n                    }\n                    return;\n                })\n                .then(function() {\n                    // Send a request to the server to make the change.\n                    return CalendarRepository.updateEventStartDay(eventId, destinationTimestamp);\n                })\n                .then(function() {\n                    // If the update was successful then broadcast an event letting the calendar\n                    // know that an event has been moved.\n                    $('body').trigger(CalendarEvents.eventMoved, [eventId, originElement, destinationElement]);\n                    return;\n                })\n                .always(function() {\n                    // Always remove the loading icons regardless of whether the update\n                    // request was successful or not.\n                    var destinationLoadingElement = destinationElement.find(SELECTORS.LOADING_ICON);\n                    destinationElement.find(SELECTORS.DAY_CONTENT).removeClass('hidden');\n                    Templates.replaceNode(destinationLoadingElement, '', '');\n\n                    if (originElement) {\n                        var originLoadingElement = originElement.find(SELECTORS.LOADING_ICON);\n                        originElement.find(SELECTORS.DAY_CONTENT).removeClass('hidden');\n                        Templates.replaceNode(originLoadingElement, '', '');\n                    }\n                    return;\n                })\n                .fail(Notification.exception);\n        }\n    };\n\n    /**\n     * Listen to and handle any calendar events fired by the calendar UI.\n     *\n     * @method registerCalendarEventListeners\n     * @param {object} root The calendar root element\n     * @param {object} eventFormModalPromise A promise reolved with the event form modal\n     */\n    var registerCalendarEventListeners = function(root, eventFormModalPromise) {\n        var body = $('body');\n\n        body.on(CalendarEvents.created, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n        });\n        body.on(CalendarEvents.deleted, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n        });\n        body.on(CalendarEvents.updated, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n        });\n        body.on(CalendarEvents.editActionEvent, function(e, url) {\n            // Action events needs to be edit directly on the course module.\n            window.location.assign(url);\n        });\n        // Handle the event fired by the drag and drop code.\n        body.on(CalendarEvents.moveEvent, handleMoveEvent);\n        // When an event is successfully moved we should updated the UI.\n        body.on(CalendarEvents.eventMoved, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n        });\n\n        CalendarCrud.registerEditListeners(root, eventFormModalPromise);\n    };\n\n    /**\n     * Register event listeners for the module.\n     *\n     * @param {object} root The calendar root element\n     */\n    var registerEventListeners = function(root) {\n        // Listen the click on the day link to render the day view.\n        root.on('click', SELECTORS.VIEW_DAY_LINK, function(e) {\n            var dayLink = $(e.target);\n            var year = dayLink.data('year'),\n                month = dayLink.data('month'),\n                day = dayLink.data('day'),\n                courseId = dayLink.data('courseid'),\n                categoryId = dayLink.data('categoryid');\n            CalendarViewManager.refreshDayContent(root, year, month, day, courseId, categoryId, root,\n                    'core_calendar/calendar_day').then(function() {\n                e.preventDefault();\n                var url = '?view=day&time=' + dayLink.data('timestamp');\n                return window.history.pushState({}, '', url);\n            }).fail(Notification.exception);\n        });\n\n        root.on('change', CalendarSelectors.elements.courseSelector, function() {\n            var selectElement = $(this);\n            var courseId = selectElement.val();\n            CalendarViewManager.reloadCurrentMonth(root, courseId, null)\n                .then(function() {\n                    // We need to get the selector again because the content has changed.\n                    return root.find(CalendarSelectors.elements.courseSelector).val(courseId);\n                })\n                .fail(Notification.exception);\n        });\n\n        var eventFormPromise = CalendarCrud.registerEventFormModal(root),\n            contextId = $(SELECTORS.CALENDAR_MONTH_WRAPPER).data('context-id');\n        registerCalendarEventListeners(root, eventFormPromise);\n\n        if (contextId) {\n            const addEventButtonsOnMonthCell = document.querySelectorAll(SELECTORS.CELL_ADD_EVENT_BUTTON_MONTH);\n            const addEventButtonsOnDayCell = document.querySelectorAll(SELECTORS.CELL_ADD_EVENT_BUTTON_DAY);\n            const addEventButtonOnAddEventForm = document.querySelector(SELECTORS.ADD_EVENT_FORM_ADD_BUTTON);\n            const eventTypesOfAddEventForm = document.querySelector(SELECTORS.EVENT_TYPES);\n\n            const addEventForm = document.querySelector(SELECTORS.ADD_EVENT_FORM);\n            const addEventFormBackToSelectType = addEventForm\n                .querySelector(SELECTORS.SELECT_COURSE_WRAPPER)\n                .querySelector(SELECTORS.BACK_BUTTON_FROM_SELECT);\n            const addEventFormBackToSelectCourse = addEventForm\n                .querySelector(SELECTORS.SELECT_GROUP_WRAPPER)\n                .querySelector(SELECTORS.BACK_BUTTON_FROM_SELECT);\n\n            if (addEventButtonsOnMonthCell.length) {\n                addEventListenerToAddEventButtonOnCells(addEventButtonsOnMonthCell);\n            }\n\n            if (addEventButtonsOnDayCell.length) {\n                addEventListenerToAddEventButtonOnCells(addEventButtonsOnDayCell);\n            }\n\n            if (eventTypesOfAddEventForm) {\n                eventTypesOfAddEventForm.addEventListener(\n                    'click',\n                    getSelectorOfEventType(eventTypesOfAddEventForm)\n                );\n            }\n\n            if (addEventButtonOnAddEventForm) {\n                addEventButtonOnAddEventForm.addEventListener('click', submitEvent);\n            }\n\n            if (addEventFormBackToSelectType) {\n                addEventFormBackToSelectType.addEventListener('click', backToSelectType);\n            }\n\n            if (addEventFormBackToSelectCourse) {\n                addEventFormBackToSelectCourse.addEventListener('click', backToSelectCourse);\n            }\n\n            // Bind click events to calendar days.\n            root.on('click', SELECTORS.DAY, function (e) {\n                // const target = $(e.target);\n\n                if (e.target.closest(SELECTORS.CELL_ADD_EVENT_BUTTON_MONTH)) {\n                    return;\n                }\n\n                const calendarWrapper = document.querySelector(SELECTORS.CALENDAR_MONTH_WRAPPER);\n                const calendarData = calendarWrapper.dataset;\n\n                if (calendarData.view && calendarData.view !== \"day\") {\n                    const dayCell = e.target.closest('td');\n                    const dayCellData = dayCell.dataset;\n\n                    sessionStorage.setItem(sessionStorageTimestampNewEventFieldName, dayCellData.newEventTimestamp);\n\n                    CalendarRepository.getCalendarDayData(\n                        calendarData.year,\n                        calendarData.month,\n                        dayCellData.day,\n                        calendarData.courseid,\n                        0\n                    )\n                        .then(dayData => {\n                            const eventsOfDay = dayData.events;\n\n                            if (eventsOfDay.length) {\n                                const schedule = document.querySelector(SELECTORS.SCHEDULE);\n                                const scheduleContent = schedule.querySelector(SELECTORS.SCHEDULE_CONTENT);\n                                const scheduleAddEventButton = schedule.querySelector(\n                                    SELECTORS.SCHEDULE_ADD_EVENT_BUTTON\n                                );\n\n                                scheduleContent.innerHTML = '';\n\n                                for (let event of eventsOfDay) {\n                                    let groupColor = '#fee7ae';\n\n                                    console.log('EVENT', event);\n\n                                    if (event.groupid) {\n                                        const groupId = event.groupid;\n\n                                        document.querySelectorAll(SELECTORS.LEGEND_GROUP).forEach(group => {\n                                            if (groupId === +group.dataset.groupId) {\n                                                groupColor = group.querySelector(SELECTORS.LEGEND_GROUP_COLOR).style.backgroundColor;\n                                            }\n                                        });\n                                    }\n\n                                    const scheduleLine = getScheduleLine(groupColor);\n                                    const scheduleEventContent = getScheduleEventContent();\n                                    const scheduleEventName = getScheduleEventName();\n                                    const scheduleEventDescription = getScheduleEventDescription();\n                                    const scheduleEventGroup = getScheduleEventGroup(groupColor);\n\n                                    const eventTime = getEventTime(groupColor);\n                                    const eventTimeStart = getEventTimeStart();\n                                    const eventTimeEnd = getEventTimeEnd();\n\n                                    //To fix moodle's timestamp\n                                    const timestampStartEvent = event.timestart * 1000;\n                                    const timestampEndEvent = ( event.timestart + event.timeduration ) * 1000;\n\n                                    const timeStartEvent = getHoursAndMinutesByTimestamp(timestampStartEvent);\n                                    const timeEndEvent = getHoursAndMinutesByTimestamp(timestampEndEvent);\n\n                                    eventTimeStart.append(timeStartEvent);\n                                    eventTimeEnd.append(timeEndEvent);\n\n                                    eventTime.append(eventTimeStart, eventTimeEnd);\n\n                                    scheduleEventName.append(event.popupname);\n\n                                    scheduleEventContent.append(scheduleEventName);\n\n                                    if (event.description) {\n                                        scheduleEventDescription.append(event.description);\n                                        scheduleEventContent.append(scheduleEventDescription);\n                                    }\n\n                                    scheduleLine.append(eventTime, scheduleEventContent);\n\n                                    if (event.groupname) {\n                                        scheduleEventGroup.append(event.groupname);\n\n                                        scheduleLine.append(scheduleEventGroup);\n                                    }\n\n                                    if (event.canedit) {\n                                        scheduleLine.classList.add('can-edit');\n\n                                        scheduleLine.addEventListener('click', showChangeEventForm(event));\n                                    }\n\n                                    scheduleContent.append(scheduleLine);\n                                }\n\n                                schedule.style.display = 'block';\n\n                                document.addEventListener('click', hideScheduleEvent);\n                                scheduleAddEventButton.addEventListener('click', showAddEventFormFromDaySchedule);\n                            }\n                        })\n                        .catch(error => {\n                            console.error('GET day data', error);\n\n                            alert('GET day data ERROR. Please, report administrator')\n                        });\n                }\n\n                /*if (!target.is(SELECTORS.VIEW_DAY_LINK)) {\n                    var startTime = $(this).attr('data-new-event-timestamp');\n                    eventFormPromise.then(function (modal) {\n                        var wrapper = target.closest(CalendarSelectors.wrapper);\n                        modal.setCourseId(wrapper.data('courseid'));\n\n                        var categoryId = wrapper.data('categoryid');\n                        if (typeof categoryId !== 'undefined') {\n                            modal.setCategoryId(categoryId);\n                        }\n\n                        modal.setContextId(wrapper.data('contextId'));\n                        modal.setStartTime(startTime);\n                        modal.show();\n                        return;\n                    })\n                    .fail(Notification.exception);\n\n                    e.preventDefault();\n                }*/\n            });\n        }\n    };\n\n    const getDiv = (className) => {\n        const newDiv = document.createElement('div');\n\n        newDiv.className = className || '';\n\n        return newDiv;\n    }\n\n    const getDivWithStyles = (className, styles) => {\n        const newDiv = getDiv(className);\n\n        for (let style in styles) {\n            newDiv.style.setProperty(style, styles[style]);\n        }\n\n        return newDiv;\n    };\n\n    const getScheduleLine = (groupColor) => {\n        return getDivWithStyles('schedule-line', {\n            borderColor: groupColor,\n            background: '#EFFAFF'\n        });\n    };\n\n    const getScheduleEventContent = () => {\n        return getDiv('schedule-event-content');\n    };\n\n    const getScheduleEventName = () => {\n        return getDiv('schedule-event-name');\n    };\n\n    const getScheduleEventDescription = () => {\n        return getDiv('schedule-event-description');\n    };\n\n    const getScheduleEventGroup = (groupColor) => {\n        return getDivWithStyles('schedule-event-group', {\n            background: groupColor\n        });\n    };\n\n    const getEventTime = (groupColor) => {\n        return getDivWithStyles('event-time', {\n            background: groupColor\n        });\n    };\n\n    const getEventTimeStart = () => {\n        return getDiv('event-time-start');\n    };\n\n    const getEventTimeEnd = () => {\n        return getDiv('event-time-end');\n    };\n\n    const getHoursAndMinutesByTimestamp = (timestamp) => {\n        const fixDateIfUnderTen = (time) => {\n            return time < 10 ? '0' + time : time;\n        }\n\n        const dateByTimestamp = new Date(timestamp);\n\n        let dateHours = fixDateIfUnderTen(dateByTimestamp.getHours());\n        let dateMinutes = fixDateIfUnderTen(dateByTimestamp.getMinutes());\n\n        return `${dateHours}:${dateMinutes}`;\n    };\n\n    const hideScheduleEvent = (event) => {\n        if (!event.target.closest(SELECTORS.SCHEDULE)) {\n            document.querySelector(SELECTORS.SCHEDULE).style.display = 'none';\n            document.removeEventListener('click', hideScheduleEvent);\n        }\n    };\n\n    const showAddEventForm = (event) => {\n        const addEventForm = document.querySelector(SELECTORS.ADD_EVENT_FORM);\n        const targetCell = event.target.closest('td');\n\n        if (targetCell) {\n            sessionStorage.setItem(sessionStorageTimestampNewEventFieldName, targetCell.dataset.newEventTimestamp);\n        }\n\n        clearEventForm(addEventForm);\n\n        addEventForm.style.display = 'block';\n\n        addEventForm.querySelectorAll('input[type=datetime-local]').forEach(inputDate => {\n            const addEventDateTimestamp = +sessionStorage.getItem(sessionStorageTimestampNewEventFieldName) * 1000 ;\n            const addEventDateJSON = new Date(addEventDateTimestamp).toJSON();\n            const splitedAddEventDateJSON = addEventDateJSON.split(':');\n\n            inputDate.value = `${splitedAddEventDateJSON[0]}:${splitedAddEventDateJSON[1]}`;\n        });\n\n        setTimeout(() => {\n            document.addEventListener('click', hideAddEventForm);\n        }, 0);\n    };\n\n    const showAddEventFormFromDaySchedule = (event) => {\n        document.querySelector(SELECTORS.SCHEDULE).style.display = 'none';\n\n        showAddEventForm(event);\n    };\n\n    const showChangeEventForm = (calendarEvent) => {\n        return (event) => {\n            const changeEventForm = document.querySelector(SELECTORS.ADD_EVENT_FORM);\n            const eventNameField = changeEventForm.querySelector('input[name=name]');\n            const eventTypes = changeEventForm.querySelector(SELECTORS.EVENT_TYPES);\n            const selectCourseWrapper = changeEventForm.querySelector(SELECTORS.SELECT_COURSE_WRAPPER);\n            const selectCourse = selectCourseWrapper.querySelector(SELECTORS.SELECT_COURSE);\n            const selectGroupWrapper = changeEventForm.querySelector(SELECTORS.SELECT_GROUP_WRAPPER);\n            const selectGroup = selectGroupWrapper.querySelector(SELECTORS.SELECT_GROUP);\n            const timeStartField = changeEventForm.querySelector('input[name=time-start]');\n            const timeEndField = changeEventForm.querySelector('input[name=time-end]');\n            const descriptionField = changeEventForm.querySelector('textarea[name=description]');\n            const locationField = changeEventForm.querySelector('input[name=location]');\n\n            const deleteEventButton = changeEventForm.querySelector(SELECTORS.ADD_EVENT_FORM_DELETE_BUTTON);\n\n            const splitedTimeStartJSON = new Date(calendarEvent.timestart * 1000).toJSON().split(':');\n            const splitedTimeEndJSON = new Date((+calendarEvent.timestart + +calendarEvent.timeduration) * 1000)\n                .toJSON()\n                .split(':');\n\n            const currentCourseOption = document.createElement('option');\n            const currentGroupOption = document.createElement('option');\n\n            clearEventForm(changeEventForm);\n\n            sessionStorage.setItem(sessionStorageEventIdFieldName, calendarEvent.id);\n            sessionStorage.setItem(sessionStorageEventTypeFieldName, calendarEvent.eventtype);\n\n            eventNameField.value = calendarEvent.name;\n            timeStartField.value = `${splitedTimeStartJSON[0]}:${splitedTimeStartJSON[1]}`;\n            timeEndField.value = `${splitedTimeEndJSON[0]}:${splitedTimeEndJSON[1]}`;\n\n            if (calendarEvent.description) {\n                descriptionField.value = calendarEvent.description;\n            }\n\n            if (calendarEvent.location) {\n                locationField.value = calendarEvent.location;\n            }\n\n            eventTypes.querySelectorAll(SELECTORS.EVENT_TYPE).forEach(eventType => {\n                if (eventType.dataset.eventType === calendarEvent.eventtype) {\n                    eventType.classList.add('active');\n                }\n            });\n\n            if (calendarEvent.course) {\n                const currentCourse = calendarEvent.course;\n\n                currentCourseOption.id = currentCourse.id;\n                currentCourseOption.text = currentCourse.fullname;\n                currentCourseOption.selected = true;\n\n                selectCourse.append(currentCourseOption);\n            }\n\n            if (calendarEvent.groupid) {\n                currentGroupOption.id = calendarEvent.groupid;\n                currentGroupOption.text = calendarEvent.groupname;\n                currentGroupOption.selected = true;\n\n                selectGroup.append(currentGroupOption);\n            }\n\n            if (calendarEvent.candelete) {\n                deleteEventButton.style.display = 'block';\n            }\n\n            changeEventForm.style.display = 'block';\n\n            setTimeout(() => {\n                deleteEventButton.addEventListener('click', deleteEvent);\n                document.addEventListener('click', hideChangeEventForm);\n            }, 0);\n        }\n    };\n\n    const clearEventForm = (eventForm) => {\n        const eventNameField = eventForm.querySelector('input[name=name]');\n        const eventTypes = eventForm.querySelector(SELECTORS.EVENT_TYPES);\n        const selectCourseWrapper = eventForm.querySelector(SELECTORS.SELECT_COURSE_WRAPPER);\n        const selectCourse = selectCourseWrapper.querySelector(SELECTORS.SELECT_COURSE);\n        const selectGroupWrapper = eventForm.querySelector(SELECTORS.SELECT_GROUP_WRAPPER);\n        const selectGroup = selectGroupWrapper.querySelector(SELECTORS.SELECT_GROUP);\n        const descriptionField = eventForm.querySelector('textarea[name=description]');\n        const locationField = eventForm.querySelector('input[name=location]');\n\n        eventNameField.value = '';\n        descriptionField.value = '';\n        locationField.value = '';\n        selectCourse.innerHTML = '';\n        selectGroup.innerHTML = '';\n\n        eventTypes.querySelectorAll(SELECTORS.EVENT_TYPE).forEach(eventType => {\n            eventType.classList.remove('active');\n        });\n\n        selectGroupWrapper.style.display = 'none';\n        selectCourseWrapper.style.display = 'none';\n        eventTypes.style.display = 'flex';\n    }\n\n    const hideChangeEventForm = (event) => {\n        if (!event.target.closest(SELECTORS.ADD_EVENT_FORM)) {\n            sessionStorage.clear();\n        }\n\n        hideAddEventForm(event);\n    }\n\n    const hideAddEventForm = (event) => {\n        if (!event.target.closest(SELECTORS.ADD_EVENT_FORM)) {\n            document.querySelector(SELECTORS.ADD_EVENT_FORM).style.display = 'none';\n            document.removeEventListener('click', hideAddEventForm);\n            document.removeEventListener('click', hideChangeEventForm);\n        }\n    }\n\n    const deleteEvent = () => {\n        const eventId = sessionStorage.getItem(sessionStorageEventIdFieldName);\n\n        CalendarRepository.deleteEvent(eventId)\n            .then(deletedEvent => {\n                window.location.reload();\n            })\n            .catch(console.error);\n    };\n\n    const addEventListenerToAddEventButtonOnCells = (addEventButtonsOnCells) => {\n        for (let addEventButtonOnCell of addEventButtonsOnCells) {\n            addEventButtonOnCell.addEventListener('click', showAddEventForm);\n        }\n    }\n\n    const getSelectorOfEventType = (eventTypesDiv) => {\n        return (clickEvent) => {\n            const eventType = clickEvent.target.closest(SELECTORS.EVENT_TYPE);\n\n            if (eventType) {\n                const eventTypeValue = eventType.dataset.eventType;\n\n                eventTypesDiv.querySelectorAll(SELECTORS.EVENT_TYPE).forEach(eventTypeDiv => {\n                    eventTypeDiv.classList.remove('active');\n                });\n\n                eventType.classList.add('active');\n                sessionStorage.setItem(sessionStorageEventTypeFieldName, eventTypeValue);\n\n                switch (eventTypeValue) {\n                    case 'group': {\n                        document\n                            .querySelector(SELECTORS.ADD_EVENT_FORM)\n                            .querySelector(SELECTORS.SELECT_COURSE_WRAPPER)\n                            .querySelector(SELECTORS.SELECT_COURSE)\n                            .addEventListener('change', showSelectGroup);\n                    }\n                    case 'course': {\n                        showSelectCourse();\n                    }\n                }\n            }\n        };\n    };\n\n    const submitEvent = () => {\n        const addEventForm = document.querySelector(SELECTORS.ADD_EVENT_FORM_DATA);\n\n        if (addEventForm) {\n            const addEventFormData = new FormData(addEventForm);\n            const timeStartDate = new Date(addEventFormData.get('time-start'));\n            const timeEndDate = new Date(addEventFormData.get('time-end'));\n            const nameOfEvent = addEventFormData.get('name');\n            const descriptionOfEvent = addEventFormData.get('description');\n            const locationOfEvent = addEventFormData.get('location');\n\n            const eventType = sessionStorage.getItem(sessionStorageEventTypeFieldName);\n            const eventId = sessionStorage.getItem(sessionStorageEventIdFieldName);\n\n            console.log('EVENT TYPE: ', eventType);\n\n            if (!eventType) {\n                alert('Please, select event type');\n                return;\n            }\n\n            if (!nameOfEvent) {\n                alert('Please, type event name');\n                return;\n            }\n\n            const formData = {\n                id: eventId || 0,\n                userid: 0,\n                modulename: '',\n                instance: 0,\n                visible: 1,\n                mform_showmore_id_general: 1,\n                name: nameOfEvent,\n                'timestart[year]': timeStartDate.getFullYear(),\n                'timestart[month]': timeStartDate.getMonth() + 1,\n                'timestart[day]': timeStartDate.getDate(),\n                'timestart[hour]': timeStartDate.getHours(),\n                'timestart[minute]': timeStartDate.getMinutes(),\n                eventtype: eventType,\n                'description[text]': descriptionOfEvent || '',\n                'description[format]': 1,\n                location: locationOfEvent,\n            }\n\n            if (eventId) {\n                formData['_qf__core_calendar_local_event_forms_update'] = 1;\n            } else {\n                formData['_qf__core_calendar_local_event_forms_create'] = 1;\n            }\n\n            if (timeEndDate - timeStartDate) {\n                formData['duration'] = 1;\n                formData['timedurationuntil[year]'] = timeEndDate.getFullYear();\n                formData['timedurationuntil[month]'] = timeEndDate.getMonth() + 1;\n                formData['timedurationuntil[day]'] = timeEndDate.getDate();\n                formData['timedurationuntil[hour]'] = timeEndDate.getHours();\n                formData['timedurationuntil[minute]'] = timeEndDate.getMinutes();\n            } else {\n                formData['duration'] = 0;\n            }\n\n            switch (eventType) {\n                case 'group': {\n                    const courseId = addEventFormData.get('courseId');\n                    const groupId = addEventFormData.get('groupId');\n\n                    if (!courseId || courseId === '-1') {\n                        alert('Please, select group');\n                        return;\n                    }\n\n                    if (!groupId || groupId === '-1') {\n                        alert('Please, select course');\n                        return;\n                    }\n\n                    formData['groupcourseid'] = courseId;\n                    formData['groupid'] = groupId;\n\n                    break;\n                }\n\n                case 'course': {\n                    const courseId = addEventFormData.get('courseId');\n\n                    if (!courseId || courseId === '-1') {\n                        alert('Please, select group');\n                        return;\n                    }\n\n                    formData['courseid'] = courseId;\n\n                    break;\n                }\n            }\n\n            let formUrlencodedData = '';\n\n            for (const keyOfField in formData) {\n                formUrlencodedData += `${keyOfField}=${formData[keyOfField]}&`;\n            }\n\n            formUrlencodedData = encodeURI(formUrlencodedData);\n\n            sessionStorage.clear();\n\n            CalendarRepository.submitCreateUpdateForm(formUrlencodedData)\n                .then(newCreatedEvent => {\n                    window.location.reload();\n                })\n                .catch(error => {\n                    console.error(error);\n                })\n        }\n    };\n\n    const backToSelectType = (event) => {\n        const courseWrapper = event.target.closest(SELECTORS.SELECT_COURSE_WRAPPER);\n\n        courseWrapper\n            .querySelector(SELECTORS.SELECT_COURSE)\n            .removeEventListener('change', showSelectGroup);\n\n        courseWrapper.style.display = 'none';\n        document.querySelector(SELECTORS.EVENT_TYPES).style.display = 'flex';\n    };\n\n    const backToSelectCourse = (event) => {\n        const courseWrapper = document.querySelector(SELECTORS.SELECT_COURSE_WRAPPER);\n\n        courseWrapper\n            .querySelector(SELECTORS.SELECT_COURSE)\n            .addEventListener('change', showSelectGroup);\n\n        event.target.closest(SELECTORS.SELECT_GROUP_WRAPPER).style.display = 'none';\n        courseWrapper.style.display = 'flex';\n    };\n\n    const showSelectCourse = () => {\n        CalendarRepository.getUserCourses()\n            .then(courses => {\n                const formAddEvent = document.querySelector(SELECTORS.ADD_EVENT_FORM);\n                const selectCourseWrapper = formAddEvent.querySelector(SELECTORS.SELECT_COURSE_WRAPPER);\n                const selectCourse = selectCourseWrapper.querySelector(SELECTORS.SELECT_COURSE);\n                const eventTypesDiv = formAddEvent.querySelector(SELECTORS.EVENT_TYPES);\n\n                setDefaultSelect(selectCourse);\n\n                if (courses.length) {\n                    appendOptionsToSelect(selectCourse, courses);\n                }\n\n                eventTypesDiv.style.display = 'none';\n                selectCourseWrapper.style.display = 'flex';\n            })\n            .catch(console.error);\n    }\n\n    const showSelectGroup = (event) => {\n        const courseId = event.target.value;\n\n        CalendarRepository.getCourseGroupsData(courseId)\n            .then(groups => {\n                const formAddEvent = document.querySelector(SELECTORS.ADD_EVENT_FORM);\n                const selectCourseWrapper = formAddEvent.querySelector(SELECTORS.SELECT_COURSE_WRAPPER);\n                const selectGroupWrapper = formAddEvent.querySelector(SELECTORS.SELECT_GROUP_WRAPPER);\n                const selectCourse = selectCourseWrapper.querySelector(SELECTORS.SELECT_COURSE);\n                const selectGroup = selectGroupWrapper.querySelector(SELECTORS.SELECT_GROUP);\n\n                setDefaultSelect(selectGroup);\n\n                selectCourse.removeEventListener('change', showSelectGroup);\n\n                if (groups.length) {\n                    appendOptionsToSelect(selectGroup, groups);\n                }\n\n                selectCourseWrapper.style.display = 'none';\n                selectGroupWrapper.style.display = 'flex';\n            })\n            .catch(console.error);\n    };\n\n    const setDefaultSelect = (select) => {\n        const emptyOption = document.createElement('option');\n        emptyOption.value = '-1';\n        emptyOption.text = '...';\n\n        select.innerHTML = '';\n        select.append(emptyOption);\n    };\n\n    const appendOptionsToSelect = (select, options) => {\n        for (const option of options) {\n            const selectOption = document.createElement('option');\n            selectOption.value = option.id;\n            selectOption.text = option.name || option.fullname;\n\n            select.append(selectOption);\n        }\n    };\n\n    return {\n        init: function(root) {\n            root = $(root);\n\n            CalendarViewManager.init(root);\n            registerEventListeners(root);\n        }\n    };\n});\n"],"file":"calendar.min.js"}