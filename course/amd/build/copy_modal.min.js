define ("core_course/copy_modal",["jquery","core/str","core/modal_factory","core/modal_events","core/ajax","core/fragment","core/notification","core/config"],function(a,b,c,d,f,g,h,i){var j={},k,l,m,n="<p class=\"text-center\"><i class=\"fa fa-spinner fa-pulse fa-2x fa-fw\"></i></p>";function o(){b.get_string("loading").then(function(a){c.create({type:c.types.DEFAULT,title:a,body:n,large:!0}).done(function(a){m=a;m.getRoot().on("click","#id_submitreturn",q);m.getRoot().on("click","#id_submitdisplay",function(a){a.formredirect=!0;q(a)});m.getRoot().on("click","#id_cancel",function(a){a.preventDefault();m.setBody(n);m.hide()})})}).catch(function(){h.exception(new Error("Failed to load string: loading"))})}function p(a){if("undefined"==typeof a){a={}}var c={jsonformdata:JSON.stringify(a),courseid:l.id};m.setBody(n);b.get_string("copycoursetitle","backup",l.shortname).then(function(a){m.setTitle(a);m.setBody(g.loadFragment("course","new_base_form",k,c))}).catch(function(){h.exception(new Error("Failed to load string: copycoursetitle"))})}function q(b){b.preventDefault();var c=m.getRoot().find("form").serialize(),d=JSON.stringify(c),e=a.merge(m.getRoot().find("[aria-invalid=\"true\"]"),m.getRoot().find(".error"));if(e.length){e.first().focus();return}f.call([{methodname:"core_backup_submit_copy_form",args:{jsonformdata:d}}])[0].done(function(){m.setBody(n);m.hide();if(!0==b.formredirect){var a=i.wwwroot+"/backup/copyprogress.php?id="+l.id;window.location.assign(a)}}).fail(function(){p(c)})}j.init=function(b){k=b;o();a(".action-copy").on("click",function(a){a.preventDefault();var b=new URL(this.getAttribute("href")),c=new URLSearchParams(b.search),d=c.get("id");f.call([{methodname:"core_course_get_courses",args:{options:{ids:[d]}}}])[0].done(function(a){l=a[0];p()}).fail(function(){h.exception(new Error("Failed to load course"))});m.show()})};return j});
//# sourceMappingURL=copy_modal.min.js.map
