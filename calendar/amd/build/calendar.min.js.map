{"version":3,"sources":["../src/calendar.js"],"names":["define","$","Ajax","Str","Templates","Notification","CustomEvents","ModalEvents","ModalFactory","ModalEventForm","SummaryModal","CalendarRepository","CalendarEvents","CalendarViewManager","CalendarCrud","CalendarSelectors","SELECTORS","ROOT","DAY","NEW_EVENT_BUTTON","DAY_CONTENT","LOADING_ICON","VIEW_DAY_LINK","CALENDAR_MONTH_WRAPPER","TODAY","sessionStorageTimestampNewEventFieldName","sessionStorageTypeNewEventFieldName","handleMoveEvent","e","eventId","originElement","destinationElement","originTimestamp","destinationTimestamp","attr","render","then","html","js","find","addClass","appendNodeContents","updateEventStartDay","trigger","eventMoved","always","destinationLoadingElement","removeClass","replaceNode","originLoadingElement","fail","exception","registerCalendarEventListeners","root","eventFormModalPromise","body","on","created","reloadCurrentMonth","deleted","updated","editActionEvent","url","window","location","assign","moveEvent","registerEditListeners","registerEventListeners","dayLink","target","year","data","month","day","courseId","categoryId","refreshDayContent","preventDefault","history","pushState","elements","courseSelector","selectElement","val","eventFormPromise","registerEventFormModal","contextId","addEventButtonsOnMonthCell","document","querySelectorAll","addEventButtonsOnDayCell","addEventButtonOnAddEventForm","querySelector","eventTypesOfAddEventForm","length","addEventListenerToAddEventButtonOnCells","addEventListener","getSelectorOfEventType","createNewEvent","closest","calendarWrapper","calendarData","dataset","view","dayCell","dayCellData","sessionStorage","setItem","newEventTimestamp","getCalendarDayData","courseid","dayData","eventsOfDay","events","schedule","scheduleContent","scheduleAddEventButton","innerHTML","event","groupColor","groupid","groupId","forEach","group","style","backgroundColor","scheduleLine","getScheduleLine","scheduleEventContent","getScheduleEventContent","scheduleEventName","getScheduleEventName","scheduleEventDescription","getScheduleEventDescription","scheduleEventGroup","getScheduleEventGroup","eventTime","getEventTime","eventTimeStart","getEventTimeStart","eventTimeEnd","getEventTimeEnd","timestampStartEvent","timestart","timestampEndEvent","timeduration","timeStartEvent","getHoursAndMinutesByTimestamp","timeEndEvent","append","popupname","description","groupname","display","hideScheduleEvent","showAddEventFormFromDaySchedule","catch","error","console","alert","getDiv","className","newDiv","createElement","getDivWithStyles","styles","setProperty","borderColor","background","timestamp","fixDateIfUnderTen","time","dateByTimestamp","Date","dateHours","getHours","dateMinutes","getMinutes","removeEventListener","showAddEventForm","addEventForm","targetCell","inputDate","addEventDateTimestamp","getItem","addEventDateJSON","toJSON","splitedAddEventDateJSON","split","value","setTimeout","hideAddEventForm","addEventButtonsOnCells","addEventButtonOnCell","eventTypesDiv","clickEvent","eventType","eventTypeDiv","classList","remove","add","addEventFormData","FormData","timeStartDate","get","timeEndDate","nameOfEvent","descriptionOfEvent","locationOfEvent","formData","id","userid","modulename","instance","visible","_qf__core_calendar_local_event_forms_create","mform_showmore_id_general","name","getFullYear","getMonth","getDay","eventtype","duration","formUrlencodedData","keyOfField","encodeURI","submitCreateUpdateForm","reload","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module is the highest level module for the calendar. It is\n * responsible for initialising all of the components required for\n * the calendar to run. It also coordinates the interaction between\n * components by listening for and responding to different events\n * triggered within the calendar UI.\n *\n * @module     core_calendar/calendar\n * @package    core_calendar\n * @copyright  2017 Simey Lameze <simey@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n            'jquery',\n            'core/ajax',\n            'core/str',\n            'core/templates',\n            'core/notification',\n            'core/custom_interaction_events',\n            'core/modal_events',\n            'core/modal_factory',\n            'core_calendar/modal_event_form',\n            'core_calendar/summary_modal',\n            'core_calendar/repository',\n            'core_calendar/events',\n            'core_calendar/view_manager',\n            'core_calendar/crud',\n            'core_calendar/selectors',\n        ],\n        function(\n            $,\n            Ajax,\n            Str,\n            Templates,\n            Notification,\n            CustomEvents,\n            ModalEvents,\n            ModalFactory,\n            ModalEventForm,\n            SummaryModal,\n            CalendarRepository,\n            CalendarEvents,\n            CalendarViewManager,\n            CalendarCrud,\n            CalendarSelectors\n        ) {\n\n    var SELECTORS = {\n        ROOT: \"[data-region='calendar']\",\n        DAY: \"[data-region='day']\",\n        NEW_EVENT_BUTTON: \"[data-action='new-event-button']\",\n        DAY_CONTENT: \"[data-region='day-content']\",\n        LOADING_ICON: '.loading-icon',\n        VIEW_DAY_LINK: \"[data-action='view-day-link']\",\n        CALENDAR_MONTH_WRAPPER: \".calendarwrapper\",\n        TODAY: '.today',\n    };\n\n    const sessionStorageTimestampNewEventFieldName = 'newEventTimestamp';\n    const sessionStorageTypeNewEventFieldName = 'newEventType';\n\n    /**\n     * Handler for the drag and drop move event. Provides a loading indicator\n     * while the request is sent to the server to update the event start date.\n     *\n     * Triggers a eventMoved calendar javascript event if the event was successfully\n     * updated.\n     *\n     * @param {event} e The calendar move event\n     * @param {int} eventId The event id being moved\n     * @param {object|null} originElement The jQuery element for where the event is moving from\n     * @param {object} destinationElement The jQuery element for where the event is moving to\n     */\n    var handleMoveEvent = function(e, eventId, originElement, destinationElement) {\n        var originTimestamp = null;\n        var destinationTimestamp = destinationElement.attr('data-day-timestamp');\n\n        if (originElement) {\n            originTimestamp = originElement.attr('data-day-timestamp');\n        }\n\n        // If the event has actually changed day.\n        if (!originElement || originTimestamp != destinationTimestamp) {\n            Templates.render('core/loading', {})\n                .then(function(html, js) {\n                    // First we show some loading icons in each of the days being affected.\n                    destinationElement.find(SELECTORS.DAY_CONTENT).addClass('hidden');\n                    Templates.appendNodeContents(destinationElement, html, js);\n\n                    if (originElement) {\n                        originElement.find(SELECTORS.DAY_CONTENT).addClass('hidden');\n                        Templates.appendNodeContents(originElement, html, js);\n                    }\n                    return;\n                })\n                .then(function() {\n                    // Send a request to the server to make the change.\n                    return CalendarRepository.updateEventStartDay(eventId, destinationTimestamp);\n                })\n                .then(function() {\n                    // If the update was successful then broadcast an event letting the calendar\n                    // know that an event has been moved.\n                    $('body').trigger(CalendarEvents.eventMoved, [eventId, originElement, destinationElement]);\n                    return;\n                })\n                .always(function() {\n                    // Always remove the loading icons regardless of whether the update\n                    // request was successful or not.\n                    var destinationLoadingElement = destinationElement.find(SELECTORS.LOADING_ICON);\n                    destinationElement.find(SELECTORS.DAY_CONTENT).removeClass('hidden');\n                    Templates.replaceNode(destinationLoadingElement, '', '');\n\n                    if (originElement) {\n                        var originLoadingElement = originElement.find(SELECTORS.LOADING_ICON);\n                        originElement.find(SELECTORS.DAY_CONTENT).removeClass('hidden');\n                        Templates.replaceNode(originLoadingElement, '', '');\n                    }\n                    return;\n                })\n                .fail(Notification.exception);\n        }\n    };\n\n    /**\n     * Listen to and handle any calendar events fired by the calendar UI.\n     *\n     * @method registerCalendarEventListeners\n     * @param {object} root The calendar root element\n     * @param {object} eventFormModalPromise A promise reolved with the event form modal\n     */\n    var registerCalendarEventListeners = function(root, eventFormModalPromise) {\n        var body = $('body');\n\n        body.on(CalendarEvents.created, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n        });\n        body.on(CalendarEvents.deleted, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n        });\n        body.on(CalendarEvents.updated, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n        });\n        body.on(CalendarEvents.editActionEvent, function(e, url) {\n            // Action events needs to be edit directly on the course module.\n            window.location.assign(url);\n        });\n        // Handle the event fired by the drag and drop code.\n        body.on(CalendarEvents.moveEvent, handleMoveEvent);\n        // When an event is successfully moved we should updated the UI.\n        body.on(CalendarEvents.eventMoved, function() {\n            CalendarViewManager.reloadCurrentMonth(root);\n        });\n\n        CalendarCrud.registerEditListeners(root, eventFormModalPromise);\n    };\n\n    /**\n     * Register event listeners for the module.\n     *\n     * @param {object} root The calendar root element\n     */\n    var registerEventListeners = function(root) {\n        // Listen the click on the day link to render the day view.\n        root.on('click', SELECTORS.VIEW_DAY_LINK, function(e) {\n            var dayLink = $(e.target);\n            var year = dayLink.data('year'),\n                month = dayLink.data('month'),\n                day = dayLink.data('day'),\n                courseId = dayLink.data('courseid'),\n                categoryId = dayLink.data('categoryid');\n            CalendarViewManager.refreshDayContent(root, year, month, day, courseId, categoryId, root,\n                    'core_calendar/calendar_day').then(function() {\n                e.preventDefault();\n                var url = '?view=day&time=' + dayLink.data('timestamp');\n                return window.history.pushState({}, '', url);\n            }).fail(Notification.exception);\n        });\n\n        root.on('change', CalendarSelectors.elements.courseSelector, function() {\n            var selectElement = $(this);\n            var courseId = selectElement.val();\n            CalendarViewManager.reloadCurrentMonth(root, courseId, null)\n                .then(function() {\n                    // We need to get the selector again because the content has changed.\n                    return root.find(CalendarSelectors.elements.courseSelector).val(courseId);\n                })\n                .fail(Notification.exception);\n        });\n\n        var eventFormPromise = CalendarCrud.registerEventFormModal(root),\n            contextId = $(SELECTORS.CALENDAR_MONTH_WRAPPER).data('context-id');\n        registerCalendarEventListeners(root, eventFormPromise);\n\n        if (contextId) {\n            const addEventButtonsOnMonthCell = document.querySelectorAll('div.cell-plus-add-event');\n            const addEventButtonsOnDayCell = document.querySelectorAll('div.c-d-add-event');\n            const addEventButtonOnAddEventForm = document.querySelector('div.add-event-add-button');\n            const eventTypesOfAddEventForm = document.querySelector('div.event-types');\n\n            if (addEventButtonsOnMonthCell.length) {\n                addEventListenerToAddEventButtonOnCells(addEventButtonsOnMonthCell);\n            }\n\n            if (addEventButtonsOnDayCell.length) {\n                addEventListenerToAddEventButtonOnCells(addEventButtonsOnDayCell);\n            }\n\n            if (eventTypesOfAddEventForm) {\n                eventTypesOfAddEventForm.addEventListener(\n                    'click',\n                    getSelectorOfEventType(eventTypesOfAddEventForm)\n                );\n            }\n\n            if (addEventButtonOnAddEventForm) {\n                addEventButtonOnAddEventForm.addEventListener('click', createNewEvent);\n            }\n\n            // Bind click events to calendar days.\n            root.on('click', SELECTORS.DAY, function (e) {\n                // const target = $(e.target);\n\n                const addEventFormQuery = 'div.add-event';\n\n                if (e.target.closest(addEventFormQuery)) {\n                    return;\n                }\n\n                const calendarWrapper = document.querySelector(SELECTORS.CALENDAR_MONTH_WRAPPER);\n                const calendarData = calendarWrapper.dataset;\n\n                if (calendarData.view && calendarData.view !== \"day\") {\n                    const dayCell = e.target.closest('td');\n                    const dayCellData = dayCell.dataset;\n\n                    sessionStorage.setItem(sessionStorageTimestampNewEventFieldName, dayCellData.newEventTimestamp);\n\n                    CalendarRepository.getCalendarDayData(\n                        calendarData.year,\n                        calendarData.month,\n                        dayCellData.day,\n                        calendarData.courseid,\n                        0\n                    )\n                        .then(dayData => {\n                            const eventsOfDay = dayData.events;\n\n                            if (eventsOfDay.length) {\n                                const schedule = document.querySelector('.schedule');\n                                const scheduleContent = schedule.querySelector('div.schedule-content');\n                                const scheduleAddEventButton = schedule.querySelector('div.add-schedule-event');\n\n                                scheduleContent.innerHTML = '';\n\n                                for (let event of eventsOfDay) {\n                                    let groupColor = '#fee7ae';\n\n                                    if (event.groupid) {\n                                        const groupId = event.groupid;\n                                        const queryLegendGroups = '.legend-group';\n\n                                        document.querySelectorAll(queryLegendGroups).forEach(group => {\n                                            if (groupId === +group.dataset.groupId) {\n                                                const legendGroupColorQuery = '.legend-group-color';\n                                                groupColor = group.querySelector(legendGroupColorQuery).style.backgroundColor;\n                                            }\n                                        });\n                                    }\n\n                                    const scheduleLine = getScheduleLine(groupColor);\n                                    const scheduleEventContent = getScheduleEventContent();\n                                    const scheduleEventName = getScheduleEventName();\n                                    const scheduleEventDescription = getScheduleEventDescription();\n                                    const scheduleEventGroup = getScheduleEventGroup(groupColor);\n\n                                    const eventTime = getEventTime(groupColor);\n                                    const eventTimeStart = getEventTimeStart();\n                                    const eventTimeEnd = getEventTimeEnd();\n\n                                    //To fix moodle's timestamp\n                                    const timestampStartEvent = event.timestart * 1000;\n                                    const timestampEndEvent = ( event.timestart + event.timeduration ) * 1000;\n\n                                    const timeStartEvent = getHoursAndMinutesByTimestamp(timestampStartEvent);\n                                    const timeEndEvent = getHoursAndMinutesByTimestamp(timestampEndEvent);\n\n                                    eventTimeStart.append(timeStartEvent);\n                                    eventTimeEnd.append(timeEndEvent);\n\n                                    eventTime.append(eventTimeStart, eventTimeEnd);\n\n                                    scheduleEventName.append(event.popupname);\n\n                                    scheduleEventContent.append(scheduleEventName);\n\n                                    if (event.description) {\n                                        scheduleEventDescription.append(event.description);\n                                        scheduleEventContent.append(scheduleEventDescription);\n                                    }\n\n                                    scheduleLine.append(eventTime, scheduleEventContent);\n\n                                    if (event.groupname) {\n                                        scheduleEventGroup.append(event.groupname);\n\n                                        scheduleLine.append(scheduleEventGroup);\n                                    }\n\n                                    scheduleContent.append(scheduleLine);\n                                }\n\n                                schedule.style.display = 'block';\n\n                                document.addEventListener('click', hideScheduleEvent);\n                                scheduleAddEventButton.addEventListener('click', showAddEventFormFromDaySchedule);\n                            }\n                        })\n                        .catch(error => {\n                            console.error('GET day data', error);\n\n                            alert('GET day data ERROR. Please, report administrator')\n                        });\n                }\n\n                /*if (!target.is(SELECTORS.VIEW_DAY_LINK)) {\n                    var startTime = $(this).attr('data-new-event-timestamp');\n                    eventFormPromise.then(function (modal) {\n                        var wrapper = target.closest(CalendarSelectors.wrapper);\n                        modal.setCourseId(wrapper.data('courseid'));\n\n                        var categoryId = wrapper.data('categoryid');\n                        if (typeof categoryId !== 'undefined') {\n                            modal.setCategoryId(categoryId);\n                        }\n\n                        modal.setContextId(wrapper.data('contextId'));\n                        modal.setStartTime(startTime);\n                        modal.show();\n                        return;\n                    })\n                    .fail(Notification.exception);\n\n                    e.preventDefault();\n                }*/\n            });\n        }\n    };\n\n    const getDiv = (className) => {\n        const newDiv = document.createElement('div');\n\n        newDiv.className = className || '';\n\n        return newDiv;\n    }\n\n    const getDivWithStyles = (className, styles) => {\n        const newDiv = getDiv(className);\n\n        for (let style in styles) {\n            newDiv.style.setProperty(style, styles[style]);\n        }\n\n        return newDiv;\n    };\n\n    const getScheduleLine = (groupColor) => {\n        return getDivWithStyles('schedule-line', {\n            borderColor: groupColor,\n            background: '#EFFAFF'\n        });\n    };\n\n    const getScheduleEventContent = () => {\n        return getDiv('schedule-event-content');\n    };\n\n    const getScheduleEventName = () => {\n        return getDiv('schedule-event-name');\n    };\n\n    const getScheduleEventDescription = () => {\n        return getDiv('schedule-event-description');\n    };\n\n    const getScheduleEventGroup = (groupColor) => {\n        return getDivWithStyles('schedule-event-group', {\n            background: groupColor\n        });\n    };\n\n    const getEventTime = (groupColor) => {\n        return getDivWithStyles('event-time', {\n            background: groupColor\n        });\n    };\n\n    const getEventTimeStart = () => {\n        return getDiv('event-time-start');\n    };\n\n    const getEventTimeEnd = () => {\n        return getDiv('event-time-end');\n    };\n\n    const getHoursAndMinutesByTimestamp = (timestamp) => {\n        const fixDateIfUnderTen = (time) => {\n            return time < 10 ? '0' + time : time;\n        }\n\n        const dateByTimestamp = new Date(timestamp);\n\n        let dateHours = fixDateIfUnderTen(dateByTimestamp.getHours());\n        let dateMinutes = fixDateIfUnderTen(dateByTimestamp.getMinutes());\n\n        return `${dateHours}:${dateMinutes}`;\n    };\n\n    const hideScheduleEvent = (event) => {\n        const scheduleQuery = '.schedule';\n\n        if (!event.target.closest(scheduleQuery)) {\n            document.querySelector(scheduleQuery).style.display = 'none';\n            document.removeEventListener('click', hideScheduleEvent);\n        }\n    };\n\n    const showAddEventForm = (event) => {\n        const addEventFormQuery = 'div.add-event';\n        const addEventForm = document.querySelector(addEventFormQuery);\n        const targetCell = event.target.closest('td');\n\n        if (targetCell) {\n            sessionStorage.setItem(sessionStorageTimestampNewEventFieldName, targetCell.dataset.newEventTimestamp);\n        }\n\n        addEventForm.style.display = 'block';\n\n        addEventForm.querySelectorAll('input[type=datetime-local]').forEach(inputDate => {\n            const addEventDateTimestamp = +sessionStorage.getItem(sessionStorageTimestampNewEventFieldName) * 1000 ;\n            const addEventDateJSON = new Date(addEventDateTimestamp).toJSON();\n            const splitedAddEventDateJSON = addEventDateJSON.split(':');\n\n            inputDate.value = `${splitedAddEventDateJSON[0]}:${splitedAddEventDateJSON[1]}`;\n        });\n\n        setTimeout(() => {\n            document.addEventListener('click', hideAddEventForm);\n        }, 0);\n    }\n\n    const showAddEventFormFromDaySchedule = (event) => {\n        const scheduleQuery = '.schedule';\n\n        document.querySelector(scheduleQuery).style.display = 'none';\n\n        showAddEventForm(event);\n    };\n\n    const hideAddEventForm = (event) => {\n        const addEventFormQuery = 'div.add-event';\n\n        if (!event.target.closest(addEventFormQuery)) {\n            document.querySelector(addEventFormQuery).style.display = 'none';\n            document.removeEventListener('click', hideAddEventForm);\n        }\n    }\n\n    const addEventListenerToAddEventButtonOnCells = (addEventButtonsOnCells) => {\n        for (let addEventButtonOnCell of addEventButtonsOnCells) {\n            addEventButtonOnCell.addEventListener('click', showAddEventForm);\n        }\n    }\n\n    const getSelectorOfEventType = (eventTypesDiv) => {\n        return (clickEvent) => {\n            const eventType = clickEvent.target.closest('div.event-type');\n\n            if (eventType) {\n                eventTypesDiv.querySelectorAll('div.event-type').forEach(eventTypeDiv => {\n                    eventTypeDiv.classList.remove('active');\n                });\n\n                eventType.classList.add('active');\n                sessionStorage.setItem(sessionStorageTypeNewEventFieldName, eventType.dataset.eventType);\n            }\n        };\n    };\n\n    const createNewEvent = () => {\n        const addEventFormQuery = 'form.add-event-form';\n        const addEventForm = document.querySelector(addEventFormQuery);\n\n        if (addEventForm) {\n            const addEventFormData = new FormData(addEventForm);\n            const timeStartDate = new Date(addEventFormData.get('time-start'));\n            const timeEndDate = new Date(addEventFormData.get('time-end'));\n            const nameOfEvent = addEventFormData.get('name');\n            const descriptionOfEvent = addEventFormData.get('description');\n            const locationOfEvent = addEventFormData.get('location');\n\n            const eventType = sessionStorage.getItem(sessionStorageTypeNewEventFieldName);\n\n            const formData = {\n                id: 0,\n                userid: 0,\n                modulename: '',\n                instance: 0,\n                visible: 1,\n                _qf__core_calendar_local_event_forms_create: 1,\n                mform_showmore_id_general: 1,\n                name: nameOfEvent,\n                'timestart[year]': timeStartDate.getFullYear(),\n                'timestart[month]': timeStartDate.getMonth() + 1,\n                'timestart[day]': timeStartDate.getDay() + 16,\n                'timestart[hour]': timeStartDate.getHours(),\n                'timestart[minute]': timeStartDate.getMinutes(),\n                eventtype: eventType,\n                'description[text]': descriptionOfEvent || '',\n                'description[format]': 1,\n                location: locationOfEvent,\n                duration: timeEndDate - timeStartDate ? 1 : 0,\n                'timedurationuntil[year]': timeEndDate.getFullYear(),\n                'timedurationuntil[month]': timeEndDate.getMonth() + 1,\n                'timedurationuntil[day]': timeEndDate.getDay() + 16,\n                'timedurationuntil[hour]': timeEndDate.getHours(),\n                'timedurationuntil[minute]': timeEndDate.getMinutes(),\n            }\n\n            let formUrlencodedData = '';\n\n            for (const keyOfField in formData) {\n                formUrlencodedData += `${keyOfField}=${formData[keyOfField]}&`;\n            }\n\n            formUrlencodedData = encodeURI(formUrlencodedData);\n\n            CalendarRepository.submitCreateUpdateForm(formUrlencodedData)\n                .then(newCreatedEvent => {\n                    window.location.reload();\n                })\n                .catch(error => {\n                    console.error(error);\n                })\n        }\n    };\n\n    return {\n        init: function(root) {\n            root = $(root);\n\n            CalendarViewManager.init(root);\n            registerEventListeners(root);\n        }\n    };\n});\n"],"file":"calendar.min.js"}